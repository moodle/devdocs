"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[4384],{3905:function(e,t,o){o.d(t,{Zo:function(){return p},kt:function(){return u}});var n=o(7294);function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,n,l=function(e,t){if(null==e)return{};var o,n,l={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(l[o]=e[o]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(l[o]=e[o])}return l}var s=n.createContext({}),d=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var o=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=d(o),u=l,h=m["".concat(s,".").concat(u)]||m[u]||c[u]||a;return o?n.createElement(h,r(r({ref:t},p),{},{components:o})):n.createElement(h,r({ref:t},p))}));function u(e,t){var o=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=o.length,r=new Array(a);r[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,r[1]=i;for(var d=2;d<a;d++)r[d]=o[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,o)}m.displayName="MDXCreateElement"},5745:function(e,t,o){o.r(t),o.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return c}});var n=o(7462),l=o(3366),a=(o(7294),o(3905)),r=["components"],i={title:"PHP CodeSniffer",tags:["coding style","policies","tools"]},s=void 0,d={unversionedId:"development/tools/phpcs",id:"development/tools/phpcs",title:"PHP CodeSniffer",description:"Overview",source:"@site/general/development/tools/phpcs.md",sourceDirName:"development/tools",slug:"/development/tools/phpcs",permalink:"/devdocs/general/development/tools/phpcs",editUrl:"https://github.com/andrewnicols/devdocs/edit/main/general/development/tools/phpcs.md",tags:[{label:"coding style",permalink:"/devdocs/general/tags/coding-style"},{label:"policies",permalink:"/devdocs/general/tags/policies"},{label:"tools",permalink:"/devdocs/general/tags/tools"}],version:"current",lastUpdatedBy:"Andrew Lyons",lastUpdatedAt:1652017659,formattedLastUpdatedAt:"08/05/2022",frontMatter:{title:"PHP CodeSniffer",tags:["coding style","policies","tools"]},sidebar:"tools",previous:{title:"Moodle Development Kit",permalink:"/devdocs/general/development/tools/mdk"},next:{title:"NodeJS and Grunt",permalink:"/devdocs/general/development/tools/nodejs"}},p={},c=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Global installation",id:"global-installation",level:3},{value:"Moodle plugin",id:"moodle-plugin",level:3},{value:"Editor integrations",id:"editor-integrations",level:2},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Ignoring warnings",id:"ignoring-warnings",level:3},{value:"Recursive analysis",id:"recursive-analysis",level:3},{value:"Other report formats",id:"other-report-formats",level:3},{value:"See also",id:"see-also",level:2}],m={toc:c};function u(e){var t=e.components,o=(0,l.Z)(e,r);return(0,a.kt)("wrapper",(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"This document describes the various code sniffing tools that Moodle recommends, their purpose, and their usage."),(0,a.kt)("p",null,"Moodle has published a ruleset for the popular ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/squizlabs/PHP_CodeSniffer"},"PHPCodeSniffer")," project. The function of PHPCodeSniffer tool is to analyse PHP code, and to apply a set of rules. The rules distributed by Moodle is intended to meet the ",(0,a.kt)("a",{parentName:"p",href:"/devdocs/general/development/policies/codingstyle/"},"Moodle Coding Style"),", and output a report showing which parts of the code do not conform to this style."),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"This ruleset can either be installed separately as a globally available coding standard, or on a per-project basis as a Moodle plugin. ",(0,a.kt)("em",{parentName:"p"},"We recommend that you install the ruleset globally")," as this is easier to integrate with a wider range of editors and related tools."),(0,a.kt)("p",null,"If you use the globally installed standard, then you should use the global copy of phpcs, whilst if you use the Moodle plugin then you ",(0,a.kt)("em",{parentName:"p"},"must")," use the version of phpcs distributed with the plugin in {{local/codechecker/phpcs/bin/phpcs}}."),(0,a.kt)("h3",{id:"global-installation"},"Global installation"),(0,a.kt)("p",null,"The easiest way to install the ruleset is by using ",(0,a.kt)("a",{parentName:"p",href:"https://getcomposer.org/"},"Composer"),". By installing the ",(0,a.kt)("a",{parentName:"p",href:"https://packagist.org/packages/moodlehq/moodle-cs"},"Moodle Code Sniffer rules")," package using the global flag, Composer will install both the Moodle ruleset, and the CodeSniffer package."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ composer global require moodlehq/moodle-cs\n")),(0,a.kt)("p",null,"If you primarily work with Moodle then you may wish to set the Moodle standard as your default PHPCodeSniffer standard. You can do so using the ",(0,a.kt)("inlineCode",{parentName:"p"},"--config-set")," option to ",(0,a.kt)("inlineCode",{parentName:"p"},"phpcs"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"$ phpcs --config-set default_standard moodle\n")),(0,a.kt)("h3",{id:"moodle-plugin"},"Moodle plugin"),(0,a.kt)("p",null,"Moodle includes a copy of the PHPCodeSniffer package, and the Moodle ruleset, as part of the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/moodlehq/moodle-local_codechecker"},(0,a.kt)("inlineCode",{parentName:"a"},"moodle-local_codechecker"))," Moodle plugin. This makes the code checker available via a web-based interface for checking the syntax of a given file or folder."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ git clone git://github.com/moodlehq/moodle-local_codechecker.git local/codechecker\n")),(0,a.kt)("p",null,"It is recommended that you add the plugin to your ",(0,a.kt)("em",{parentName:"p"},"local")," git ignore:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ echo local/codechecker >> .git/info/exclude\n")),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},".git/info/exclude")," file is a per-repository version of the ",(0,a.kt)("inlineCode",{parentName:"p"},".gitignore")," file. Whilst ",(0,a.kt)("inlineCode",{parentName:"p"},".gitignore")," is tracked within the Moodle codebase and a version is shipped with Moodle, the ",(0,a.kt)("inlineCode",{parentName:"p"},".git/info/exclude")," file is local to your git clone."),(0,a.kt)("p",{parentName:"div"},"See the ",(0,a.kt)("a",{parentName:"p",href:"https://git-scm.com/docs/gitignore"},"gitignore")," documentation for more information on the gitignore feature."))),(0,a.kt)("p",null,"Once installed a new codechecker option will appear in the Site administration -> Development page."),(0,a.kt)("p",null,"This page allows for the code in a specified directory to be checked, for example if you wanted to check the code for the ",(0,a.kt)("inlineCode",{parentName:"p"},"shortanswer")," question type you would enter"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/question/type/shortanswer\n")),(0,a.kt)("p",null,"You would then be presented with a list of the count of files processed and any warnings or errors."),(0,a.kt)("h2",{id:"editor-integrations"},"Editor integrations"),(0,a.kt)("p",null,"Many modern editors and IDEs will natively integrate with PHPCodeSniffer, and most will allow you to specify a per-project default standard rather than requiring the standard be set as a global default. For example, the ",(0,a.kt)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=obliviousharmony.vscode-php-codesniffer"},"VS Code PHP_CodeSniffer extension")," can be configured to specify the standard to use."),(0,a.kt)("h2",{id:"advanced-usage"},"Advanced Usage"),(0,a.kt)("h3",{id:"ignoring-warnings"},"Ignoring warnings"),(0,a.kt)("p",null,"You can run the CodeSniffer with the -n flag to ignore warnings:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ phpcs -n index.php\n--------------------------------------------------------------------------------\nFOUND 139 ERROR(S) AFFECTING 125 LINE(S)\n--------------------------------------------------------------------------------\n  28 | ERROR | line indented incorrectly; expected 0 spaces, found 4\n  50 | ERROR | line indented incorrectly; expected 0 spaces, found 4\n...\n")),(0,a.kt)("h3",{id:"recursive-analysis"},"Recursive analysis"),(0,a.kt)("p",null,"If you give the name of a folder instead of a file, it will search, analyse and report on all PHP files found in this folder and all its subfolders. This will produce a full report for each PHP file. Since this is likely to be too much information, you may want to print only a summary report, by using the following syntax (search the files/ folder as an example):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ phpcs --report=summary blocks/html\nPHP CODE SNIFFER REPORT SUMMARY\n-----------------------------------------------------------------------------------------------------------------------\nFILE                                                                                                   ERRORS  WARNINGS\n-----------------------------------------------------------------------------------------------------------------------\n/var/www/html/moodle/blocks/html/block_html.php                                       24      0\n/var/www/html/moodle/blocks/html/edit_form.php                                        16      0\n/var/www/html/moodle/blocks/html/lib.php                                              11      0\n/var/www/html/moodle/blocks/html/settings.php                                         6       0\n/var/www/html/moodle/blocks/html/backup/moodle2/backup_html_block_task.class.php      2       0\n/var/www/html/moodle/blocks/html/backup/moodle2/restore_html_block_task.class.php     3       0\n/var/www/html/moodle/blocks/html/classes/privacy/provider.php                         13      0\n/var/www/html/moodle/blocks/html/classes/search/content.php                           6       0\n/var/www/html/moodle/blocks/html/tests/search_content_test.php                        6       0\n-----------------------------------------------------------------------------------------------------------------------\nA TOTAL OF 87 ERRORS AND 0 WARNINGS WERE FOUND IN 9 FILES\n-----------------------------------------------------------------------------------------------------------------------\nPHPCBF CAN FIX 75 OF THESE SNIFF VIOLATIONS AUTOMATICALLY\n-----------------------------------------------------------------------------------------------------------------------\n\nTime: 626ms; Memory: 16MB\n")),(0,a.kt)("h3",{id:"other-report-formats"},"Other report formats"),(0,a.kt)("p",null,"CodeSniffer can export its reports in the following formats:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"full"),": default, shown first above"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"summary"),": also shown above"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"xml"),": Simple XML format"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"csv"),": Comma-separated list"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"checkstyle"),": XML format intended for use with CruiseControl")),(0,a.kt)("h2",{id:"see-also"},"See also"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"",(0,a.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Coding"},"Coding"),""),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"/devdocs/general/development/policies/codingstyle/"},"Coding style"))))}u.isMDXComponent=!0}}]);