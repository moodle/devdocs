(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[24411],{88698:function(e,t,n){"use strict";var a=n(75963);t.Z=void 0;var i=a(n(64938)),o=n(85893),r=(0,i.default)((0,o.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3 1 9l11 6 9-4.91V17h2V9L12 3z"}),"School");t.Z=r},60620:function(e,t,n){"use strict";n.d(t,{nR:function(){return s}});var a=n(67294),i=n(80069),o=n(3905),r=n(78989),l=function(e){return"boolean"!=typeof e&&e?"string"==typeof e||a.isValidElement(e)?a.createElement(o.Zo,null,e):a.createElement(o.Zo,null,a.createElement(e,null)):null},s=function(e){var t,n,s,p=function(e){return Object.assign({filetype:"php",examplePurpose:e.summary},e)}(Object.assign({examplePurpose:null!=(t=null==e?void 0:e.summary)?t:null},e));(p.description=function(e,t){var n=e.description,i=void 0===n?null:n,r=e.extraDescription,s=void 0===r?null:r,p=e.children,d=void 0===p?null:p;if(d){var u=l(d);return a.createElement(o.Zo,null,u)}if(i){var c=l(i);return a.createElement(o.Zo,null,c)}var m=l(t),h=l(s);return m?a.createElement(o.Zo,null,m,h):null}(p,null!=(n=null==p?void 0:p.defaultDescription)?n:null),null!=p&&p.example||null!=p&&p.defaultExample)&&(p.example=(0,r.W7)(p,null!=(s=null==p?void 0:p.defaultExample)?s:null));return(0,i.Z)(p)}},95757:function(e,t,n){"use strict";n.d(t,{D5:function(){return m},dk:function(){return y},i9:function(){return _},Jk:function(){return T},Id:function(){return C},MC:function(){return F},tw:function(){return X},_n:function(){return j},c5:function(){return Q},Hg:function(){return ie},BO:function(){return pe},L5:function(){return he},oI:function(){return ke},sY:function(){return xe},T5:function(){return Ie},ss:function(){return Ze},Uo:function(){return Oe},Gf:function(){return Ue},KQ:function(){return Ge},Y1:function(){return et},J$:function(){return ot},t5:function(){return dt},Wy:function(){return ft},dU:function(){return bt},NA:function(){return At},ZA:function(){return Lt},f_:function(){return Dt},My:function(){return zt}});var a=n(83117),i=n(67294),o=n(60620),r=n(80102),l=n(3905),s=n(13904),p=["components"],d={},u={toc:[]};function c(e){var t=e.components,n=(0,r.Z)(e,p);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:d},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"JavaScript in Moodle is written in the ESM format, and transpiled into AMD modules for deployment."),(0,l.kt)("p",null,"The ",(0,l.kt)("a",{parentName:"p",href:"../guides/javascript"},"Moodle JavaScript Guide")," has detailed information and examples on writing JavaScript in Moodle. Further information is also available in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Javascript_Modules"},"Javascript Modules")," documentation."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Although the AMD module format is supported, all new JavaScript is written in the EcmaScript Module (ESM) format."))))}c.isMDXComponent=!0;var m=function(e){return i.createElement(o.nR,(0,a.Z)({required:!0,defaultDescription:c,defaultExample:"\nimport {fetchThings} from './repository';\n\nexport const updateThings = (thingData) => {\n    return fetchThings(thingData);\n};\n",examplePurpose:"Example module",filepath:"/amd/src/example.js",filetype:"js",modulename:"example",summary:"AMD JavaScript Modules"},e))},h=["components"],f={},g={toc:[]};function v(e){var t=e.components,n=(0,r.Z)(e,h);return(0,l.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:f},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"If your plugin stores data then you may need to implement the Backup feature which allows the activity to backed up, restored, and duplicated."),(0,l.kt)("p",null,"For more information on Backup and restore, see the following:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Backup_2.0_for_developers"},"Backup 2.0 for developers")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Restore_2.0_for_developers"},"Restore 2.0 for developers"))))}v.isMDXComponent=!0;var y=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/backup/",summary:"Plugin Backup configuration",defaultDescription:v},e))},k=["components"],b={},N={toc:[]};function w(e){var t=e.components,n=(0,r.Z)(e,k);return(0,l.kt)("wrapper",(0,a.Z)({},N,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:b},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"For plugins which make use of ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/CLI_scripts"},"CLI scripts"),", the convention is that these are placed into the ",(0,l.kt)("inlineCode",{parentName:"p"},"cli")," folder to make their purpose clear, and easy to find."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"All CLI scripts ",(0,l.kt)("strong",{parentName:"p"},"must")," declare themselves as being a CLI script by defining the ",(0,l.kt)("inlineCode",{parentName:"p"},"CLI_SCRIPT")," constant to true before including ",(0,l.kt)("inlineCode",{parentName:"p"},"config.php"),"."))))}w.isMDXComponent=!0;var _=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/cli/",summary:"CLI scripts",exampleFilepath:"/cli/example.php",examplePurpose:"Example CLI script",defaultDescription:w,defaultExample:"define('CLI_SCRIPT', true);\n\nrequire_once(__DIR__ . '/../../config.php');\nrequire_once(\"{$CFG->libdir}/clilib.php\");\n\n// Your CLI features go here.\n"},e))},x=["components"],A={},M={toc:[]};function E(e){var t=e.components,n=(0,r.Z)(e,x);return(0,l.kt)("wrapper",(0,a.Z)({},M,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:A},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"If your plugin includes a changelog in its root directory, this will be used to automatically pre-fill the release notes field when uploading new versions of your plugin to the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Plugins_directory"},"Plugins directory"),". This file can be in any of the following locations:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CHANGES.md"),": as a markdown file; or"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CHANGES.txt"),": as a text file; or"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CHANGES.html"),": as an HTML file; or"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CHANGES"),": as a text file.")))}E.isMDXComponent=!0;var T=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/CHANGES",filetype:"php",summary:"Plugin changelog",recommended:!0,defaultDescription:E},e))},I=["components"],L={},R={toc:[]};function P(e){var t=e.components,n=(0,r.Z)(e,I);return(0,l.kt)("wrapper",(0,a.Z)({},R,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:L},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Moodle supports, and recommends, the use of autoloaded PHP classes."),(0,l.kt)("p",null,"By placing files within the ",(0,l.kt)("inlineCode",{parentName:"p"},"classes")," directory or appropriate sub-directories, and with the correct PHP Namespace, and class name, Moodle is able to autoload classes without the need to manually require, or include them."),(0,l.kt)("p",null,"Details on these rules and conventions are available in the following documentation:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/general/development/policies/codingstyle#namespaces"},"Coding style - namespace conventions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Automatic_class_loading"},"Automatic class loading"))))}P.isMDXComponent=!0;var C=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/classes/",summary:"Autoloaded classes",defaultDescription:P},e))},Z=["components"],D={},$={toc:[]};function S(e){var t=e.components,n=(0,r.Z)(e,Z);return(0,l.kt)("wrapper",(0,a.Z)({},$,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:D},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/access.php")," file contains the ",(0,l.kt)("strong",{parentName:"p"},"initial")," configuration for a plugin's access control rules."),(0,l.kt)("p",null,"Access control is handled in Moodle by the use of Roles, and Capabilities. You can read more about these in the ",(0,l.kt)("a",{parentName:"p",href:"/devdocs/docs/apis/subsystems/access"},"Access API")," documentation."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Changing initial configuration")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"If you make changes to the initial configuration of ",(0,l.kt)("em",{parentName:"p"},"existing")," access control rules, these will only take effect for ",(0,l.kt)("em",{parentName:"p"},"new installations of your plugin"),". Any existing installation ",(0,l.kt)("strong",{parentName:"p"},"will not")," be updated with the latest configuration."),(0,l.kt)("p",{parentName:"div"},"Updating existing capability configuration for an installed site is not recommended as it may have already been modified by an administrator."))))}S.isMDXComponent=!0;var F=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:S,defaultExample:"$capabilities = [\n    // Ability to use the plugin.\n    'plugintype/pluginname:useplugininstance' => [\n        'riskbitmask' => RISK_XSS,\n        'captype' => 'write',\n        'contextlevel' => CONTEXT_COURSE,\n        'archetypes' => [\n            'manager' => CAP_ALLOW,\n            'editingteacher' => CAP_ALLOW,\n        ],\n    ],\n];\n",filepath:"/db/access.php",summary:"Plugin capabilities",examplePurpose:"Plugin capabilities"},e))},O=["components"],z={},q={toc:[]};function B(e){var t=e.components,n=(0,r.Z)(e,O);return(0,l.kt)("wrapper",(0,a.Z)({},q,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:z},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Moodle supports a feature known as ",(0,l.kt)("em",{parentName:"p"}," ",(0,l.kt)("a",{parentName:"em",href:"https://docs.moodle.org/dev/Events_API#Event_observers"},"Event observers")," ")," to allow components to make changes when certain events take place."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/events.php")," file allows you define any event subscriptions that your plugin needs to listen for."),(0,l.kt)("p",null,"Event subscriptions are a convenient way to observe events generated elsewhere in Moodle."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Communication between components")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"You ",(0,l.kt)("em",{parentName:"p"},"should not")," use event subscriptions to subscribe to events belonging to other plugins, without defining a dependency upon that plugin."),(0,l.kt)("p",{parentName:"div"},"See the ",(0,l.kt)("a",{parentName:"p",href:"/general/development/policies/component-communication#event-observers"},"Component communication principles")," documentation for a description of some of the risks of doing so."))))}B.isMDXComponent=!0;var X=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringUpgrade:!0,defaultDescription:B,defaultExample:"$observers = [\n    [\n        'eventname' => '\\core\\event\\course_module_created',\n        'callback'  => '\\plugintype_pluginname\\event\\observer\\course_module_created::store',\n        'priority'  => 1000,\n    ],\n];\n",filepath:"/db/events.php",summary:"Event observer definitions",examplePurpose:"Event observer definitions"},e))},U=["components"],H={},W={toc:[]};function V(e){var t=e.components,n=(0,r.Z)(e,U);return(0,l.kt)("wrapper",(0,a.Z)({},W,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:H},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/install.php")," file allows you define a post-installation hook, which is called immediately after the initial creation of your database schema."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"This file is not used at all after the ",(0,l.kt)("em",{parentName:"p"},"initial")," installation of your plugin."),(0,l.kt)("p",{parentName:"div"},"It is ",(0,l.kt)("em",{parentName:"p"},"not called")," during any upgrade."))))}V.isMDXComponent=!0;var j=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:V,filepath:"/CHANGES",filetype:"php",summary:"Post-installation hook"},e))},G=["components"],Y={},K={toc:[]};function J(e){var t=e.components,n=(0,r.Z)(e,G);return(0,l.kt)("wrapper",(0,a.Z)({},K,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Y},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"install.xml")," file is used to define any database tables, fields, indexes, and keys, which should be created for a plugin during its initial installation."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"When creating or updating the ",(0,l.kt)("inlineCode",{parentName:"p"},"install.xml")," you ",(0,l.kt)("strong",{parentName:"p"},"must")," use the built-in ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/XMLDB_Documentation"},"XMLDB editor")," within Moodle."))))}J.isMDXComponent=!0;var Q=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/db/install.xml",summary:"Database schema",examplePurpose:"Database schema",defaultDescription:J},e))},ee=["components"],te={},ne={toc:[]};function ae(e){var t=e.components,n=(0,r.Z)(e,ee);return(0,l.kt)("wrapper",(0,a.Z)({},ne,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:te},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/messages.php")," file allows you to declare the messages that your plugin sends."),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Message_API"},"Message API")," documentation for further information."))}ae.isMDXComponent=!0;var ie=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringUpgrade:!0,defaultExample:"\n$messageproviders = [\n    'things' => [\n        'defaults' => [\n            'airnotifier' => MESSAGE_PERMITTED + MESSAGE_DEFAULT_ENABLED,\n        ],\n    ],\n];\n",defaultDescription:ae,filepath:"/db/messages.php",summary:"Message provider configuration",examplePurpose:"Message provider configuration"},e))},oe=["components"],re={},le={toc:[]};function se(e){var t=e.components,n=(0,r.Z)(e,oe);return(0,l.kt)("wrapper",(0,a.Z)({},le,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:re},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The Moodle Mobile remote add-on is the mobile app version of the plugin that will be loaded when a user accesses the plugin on the app."),(0,l.kt)("p",null,"A plugin can include several Mobile add-ons. Each add-on must indicate a unique name."),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"../../moodleapp/development/plugins-development-guide"},"Moodle App Plugins development guide")," for more information on configuring your plugin for the Moodle App."))}se.isMDXComponent=!0;var pe=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringUpgrade:!0,defaultDescription:se,filepath:"/db/mobile.php",summary:"MoodleMobile version of the plugin"},e))},de=["components"],ue={},ce={toc:[]};function me(e){var t=e.components,n=(0,r.Z)(e,de);return(0,l.kt)("wrapper",(0,a.Z)({},ce,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:ue},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Details of classes that have been renamed to fit in with autoloading. See ",(0,l.kt)("a",{parentName:"p",href:"https://moodle.org/mod/forum/discuss.php?d=262403"},"forum discussion")," for details."))}me.isMDXComponent=!0;var he=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringPurge:!0,defaultExample:"\ndefined('MOODLE_INTERNAL') || die;\n\n$renamedclasses = [\n    'old_class_name' => 'fully_qualified\\\\new\\\\name',\n\n    // Examples:\n    'assign_header' => 'mod_assign\\\\output\\\\header',\n    '\\assign_header' => 'mod_assign\\\\output\\\\header',\n    '\\assign' => 'mod_assign\\\\assignment',\n\n    // Incorrect:\n    // The new class name should _not_ have a leading \\.\n    'assign_header' => '\\\\mod_assign\\\\output\\\\header',\n];\n",defaultDescription:me,filepath:"/db/renamedclasses.php",summary:"Renamed classes",examplePurpose:"Renamed classes"},e))},fe=["components"],ge={},ve={toc:[]};function ye(e){var t=e.components,n=(0,r.Z)(e,fe);return(0,l.kt)("wrapper",(0,a.Z)({},ve,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:ge},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/services.php")," file is used to describe the external functions available for use in web services. This includes\nweb service functions defined for javascript, and for the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Moodle_Mobile_App"},"Moodle Mobile App"),"."),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Web services should be named following the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Web_service_API_functions#Naming_convention"},"naming convention for web services"),"."))),(0,l.kt)("p",null,"For further information on external functions and web services, see:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Adding_a_web_service_to_a_plugin"},"Adding a web service to a plugin")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Web_services_API"},"Web services API")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/External_functions_API"},"External functions API"))))}ye.isMDXComponent=!0;var ke=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringUpgrade:!0,recommended:!0,filepath:"/db/services.php",summary:"Web service function declarations",examplePurpose:"Web service function declarations",defaultExample:"\n$functions = [\n    'plugintype_pluginname_create_things' => [\n        'classname' => 'plugintype_pluginname\\external\\create_things',\n        'methodname' => 'execute',\n        'description' => 'Create a new thing',\n        'type' => 'write',\n        'capabilities' => 'plugintype/pluginname:create_things',\n        'ajax' => true,\n        'services' => [\n            MOODLE_OFFICIAL_MOBILE_SERVICE,\n        ],\n    ],\n];\n",defaultDescription:ye},e))},be=["components"],Ne={},we={toc:[]};function _e(e){var t=e.components,n=(0,r.Z)(e,be);return(0,l.kt)("wrapper",(0,a.Z)({},we,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Ne},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/uninstall.php")," file allows you define a pre-uninstallation hook, which is called immediately before all table and data from your plugin are removed."))}_e.isMDXComponent=!0;var xe=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:_e,filepath:"/db/uninstall.php",filetype:"php",summary:"Pre-uninstallation hook"},e))},Ae=["components"],Me={},Ee={toc:[]};function Te(e){var t=e.components,n=(0,r.Z)(e,Ae);return(0,l.kt)("wrapper",(0,a.Z)({},Ee,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Me},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"db/upgrade.php")," file contains upgrade steps, including database schema changes, changes to settings, and other steps which must be performed during upgrade."),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Upgrade_API"},"Upgrade API")," documentation for further information."),(0,l.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Generating Database Schema changes")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"When making changes to the database schema you ",(0,l.kt)("strong",{parentName:"p"},"must")," use the build-in ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/XMLDB_Documentation"},"XMLDB editor")," within\nMoodle. This can be used to generate php upgrade steps."),(0,l.kt)("p",{parentName:"div"},"The ",(0,l.kt)("a",{parentName:"p",href:"#dbinstallxml"},"install.xml")," schema must match the schema generated by the upgrade at all times."))),(0,l.kt)("p",null,"To create an upgrade step you must:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Use the ",(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/XMLDB_editor"},"XMLDB editor")," to create the definition of the new fields"),(0,l.kt)("li",{parentName:"ol"},"Update the ",(0,l.kt)("inlineCode",{parentName:"li"},"install.xml")," from the XMLDB editor"),(0,l.kt)("li",{parentName:"ol"},"Generate the PHP upgrade steps from within the XMLDB Editor"),(0,l.kt)("li",{parentName:"ol"},"Update the version number in your ",(0,l.kt)("inlineCode",{parentName:"li"},"version.php"))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"In many cases you will be able to combine multiple upgrade steps into a single version change."))),(0,l.kt)("p",null,"When a version number increment is detected during an upgrade, the ",(0,l.kt)("inlineCode",{parentName:"p"},"xmldb_[pluginname]_upgrade")," function is called with the old version number as the first argument."),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Upgrade_API"},"Upgrade API")," documentation for more information on the upgrade process."))}Te.isMDXComponent=!0;var Ie=function(e){return i.createElement(o.nR,(0,a.Z)({recommended:!0,defaultDescription:Te,defaultExample:"\nfunction xmldb_certificate_upgrade($oldversion = 0) {\n    if ($oldversion < 2012091800) {\n        // Add new fields to certificate table.\n        $table = new xmldb_table('certificate');\n        $field = new xmldb_field('showcode');\n        $field->set_attributes(XMLDB_TYPE_INTEGER, '1', XMLDB_UNSIGNED, XMLDB_NOTNULL, null, '0', 'savecert');\n        if (!$dbman->field_exists($table, $field)) {\n            $dbman->add_field($table, $field);\n        }\n        // Add new fields to certificate_issues table.\n        $table = new xmldb_table('certificate_issues');\n        $field = new xmldb_field('code');\n        $field->set_attributes(XMLDB_TYPE_CHAR, '50', null, null, null, null, 'certificateid');\n        if (!$dbman->field_exists($table, $field)) {\n            $dbman->add_field($table, $field);\n        }\n\n        // Certificate savepoint reached.\n        upgrade_mod_savepoint(true, 2012091800, 'certificate');\n    }\n}",filepath:"/db/upgrade.php",summary:"Upgrade steps",examplePurpose:"Upgrade steps"},e))},Le=["components"],Re={},Pe={toc:[]};function Ce(e){var t=e.components,n=(0,r.Z)(e,Le);return(0,l.kt)("wrapper",(0,a.Z)({},Pe,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Re},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"A plugin can declare its own environment requirements, in addition to those declared by Moodle core. These may includes features such as PHP extension requirements, version requirements, and similar items."),(0,l.kt)("p",null,"Further information on this file and its format can be found in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Environment_checking"},"Environment checking")," documentation."))}Ce.isMDXComponent=!0;var Ze=function(e){return i.createElement(o.nR,(0,a.Z)({showFileHeader:!1,showLicense:!1,refreshedDuringUpgrade:!0,filepath:"/environment.xml",filetype:"xml",summary:"Plugin-specific environment requirements",defaultDescription:Ce,defaultExample:'\n<?xml version="1.0" encoding="UTF-8" ?>\n<COMPATIBILITY_MATRIX>\n  <PLUGIN name="plugintype_pluginname">\n    <PHP_EXTENSIONS>\n      <PHP_EXTENSION name="soap" level="required">\n      </PHP_EXTENSION>\n    </PHP_EXTENSIONS>\n  </PLUGIN>\n</COMPATIBILITY_MATRIX>'},e))},De=["components"],$e={},Se={toc:[]};function Fe(e){var t=e.components,n=(0,r.Z)(e,De);return(0,l.kt)("wrapper",(0,a.Z)({},Se,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:$e},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Each plugin must define a set of language strings with, at a minimum, an English translation. These are specified in the plugin's ",(0,l.kt)("inlineCode",{parentName:"p"},"lang/en")," directory in a file named after the plugin. For example the LDAP authentication plugin:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php"},"// Plugin type: `auth`\n// Plugin name: `ldap`\n// Frankenstyle plugin name: `auth_ldap`\n// Plugin location: `auth/ldap`\n// Language string location: `auth/ldap/lang/en/auth_ldap.php`\n")),(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Every plugin ",(0,l.kt)("em",{parentName:"p"},"must")," define the name of the plugin, or its ",(0,l.kt)("inlineCode",{parentName:"p"},"pluginname"),"."))),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"get_string")," API can be used to translate a string identifier back into a translated string."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"get_string('pluginname', '[plugintype]_[pluginname]');\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"See the ",(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/String_API#Adding_language_file_to_plugin"},"String API")," documentation for more information on language files.")))}Fe.isMDXComponent=!0;var Oe=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/lang/en/plugintype_pluginname.php",refreshedDuringPurge:!0,required:!0,summary:"Language files",examplePurpose:"Languages configuration",defaultDescription:Fe,defaultExample:"$string['pluginname'] = 'The name of my plugin will go here';"},e))},ze=["components"],qe={},Be={toc:[]};function Xe(e){var t=e.components,n=(0,r.Z)(e,ze);return(0,l.kt)("wrapper",(0,a.Z)({},Be,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:qe},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"lib.php")," file is a legacy file which acts as a bridge between Moodle core, and the plugin. In recent plugins it is should only used to define callbacks and related functionality which currently is not supported as an auto-loadable class."),(0,l.kt)("p",null,"All functions defined in this file ",(0,l.kt)("strong",{parentName:"p"},"must")," meet the requirements set out in the relevant section of the ",(0,l.kt)("a",{parentName:"p",href:"/general/development/policies/codingstyle#Functions-and-Methods"},"Coding style"),"."),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Performance impact")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Moodle core often loads all the ",(0,l.kt)("tt",null,"lib.php")," files of a given plugin types. For performance reasons, it is strongly recommended to keep this file as small as possible and have just required code implemented in it. All the plugin's internal logic should be implemented in the auto-loaded classes."))))}Xe.isMDXComponent=!0;var Ue=function(e){return i.createElement(o.nR,(0,a.Z)({legacy:!0,required:!1,filepath:"/lib.php",summary:"Global plugin functions",examplePurpose:"Plugin functions",defaultDescription:Xe},e))},He=["components"],We={},Ve={toc:[]};function je(e){var t=e.components,n=(0,r.Z)(e,He);return(0,l.kt)("wrapper",(0,a.Z)({},Ve,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:We},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Legacy feature")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The use of this file is no longer recommended, and new uses of it will not be permitted in core code."))),(0,l.kt)("p",null,"Rather than creating global functions in a global namespace in a ",(0,l.kt)("tt",null,"locallib.php")," file, you should use autoloaded classes which are located in the ",(0,l.kt)("tt",null,"classes/")," directory."),(0,l.kt)("p",null,"Where this file is in use, all functions ",(0,l.kt)("strong",{parentName:"p"},"must")," meet the requirements set out in the relevant section of the ",(0,l.kt)("a",{parentName:"p",href:"/general/development/policies/codingstyle#Functions-and-Methods"},"Coding style")),(0,l.kt)("p",null,"Existing functions which have been incorrectly named ",(0,l.kt)("strong",{parentName:"p"},"will not")," be accepted as an example of an existing convention. Existing functions which are incorrectly named ",(0,l.kt)("strong",{parentName:"p"},"should")," be converted to use a namespaced class."))}je.isMDXComponent=!0;var Ge=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:je,filepath:"/locallib.php",legacy:!0,required:!1,summary:"Global support functions"},e))},Ye=["components"],Ke={},Je={toc:[]};function Qe(e){var t=e.components,n=(0,r.Z)(e,Ye);return(0,l.kt)("wrapper",(0,a.Z)({},Je,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Ke},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Plugins can provide icons in several formats, and most plugin types require that a default icon be provided."),(0,l.kt)("p",null,"Where a browser supports it, the ",(0,l.kt)("inlineCode",{parentName:"p"},"svg")," format is used, falling back to ",(0,l.kt)("inlineCode",{parentName:"p"},"png")," formats when an SVG is unavailable."),(0,l.kt)("p",null,"Full details of the correct naming, sizing, and design guidelines for icons in Moodle can be found in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Moodle_icons"},"Moodle icons")," documentation."))}Qe.isMDXComponent=!0;var et=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:Qe,refreshedDuringPurge:!0,filepath:"/pix/",summary:"Plugins icons"},e))},tt=["components"],nt={},at={toc:[]};function it(e){var t=e.components,n=(0,r.Z)(e,tt);return(0,l.kt)("wrapper",(0,a.Z)({},at,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:nt},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"We recommend that you include any additional information for your plugin in a project readme file. Ideally this should act as an offline version of all information in your plugin's page in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Plugins_directory"},"Plugins directory"),"."),(0,l.kt)("p",null,"We recommend creating your readme file in either a ",(0,l.kt)("inlineCode",{parentName:"p"},"README.md"),", or ",(0,l.kt)("inlineCode",{parentName:"p"},"README.txt")," format."))}it.isMDXComponent=!0;var ot=function(e){return i.createElement(o.nR,(0,a.Z)({filepath:"/README",recommended:!0,defaultDescription:it,summary:"Plugin Information for Administrators"},e))},rt=["components"],lt={},st={toc:[]};function pt(e){var t=e.components,n=(0,r.Z)(e,rt);return(0,l.kt)("wrapper",(0,a.Z)({},st,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:lt},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"When importing a third-party library into your plugin, it is advisable to create a ",(0,l.kt)("inlineCode",{parentName:"p"},"readme_moodle.txt")," file detailing relevant information, including:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Download URLs"),(0,l.kt)("li",{parentName:"ul"},"Build instructions")))}pt.isMDXComponent=!0;var dt=function(e){return i.createElement(o.nR,(0,a.Z)({recommended:!0,filepath:"/*/readme_moodle.txt",defaultDescription:pt,summary:"Third-party library import instructions"},e))},ut=["components"],ct={},mt={toc:[]};function ht(e){var t=e.components,n=(0,r.Z)(e,ut);return(0,l.kt)("wrapper",(0,a.Z)({},mt,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:ct},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"You can define settings for your plugin that the administrator can configure by creating a ",(0,l.kt)("inlineCode",{parentName:"p"},"settings.php")," file in the root of your plugins' directory."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Settings must named in the following format:"),(0,l.kt)("pre",{parentName:"div"},(0,l.kt)("code",{parentName:"pre"},"plugintype_pluginname/settingname\n")),(0,l.kt)("p",{parentName:"div"},"By following the correct naming, all settings will automatically be stored in the ",(0,l.kt)("inlineCode",{parentName:"p"},"config_plugins")," database table."))),(0,l.kt)("p",null,"Full details on how to create settings are available in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Admin_settings"},"Admin settings")," documentation."))}ht.isMDXComponent=!0;var ft=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:ht,filepath:"/settings.php",summary:"Plugin settings",examplePurpose:"Plugin settings"},e))},gt=["components"],vt={},yt={toc:[]};function kt(e){var t=e.components,n=(0,r.Z)(e,gt);return(0,l.kt)("wrapper",(0,a.Z)({},yt,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:vt},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Plugins may define a '/styles.css' to provide plugin-specific styling. See the following for further documentation:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/Plugin_contribution_checklist#CSS_styles"},"Plugin contribution checklist#CSS styles")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/CSS_Coding_Style"},"CSS Coding Style"))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Avoid custom styles where possible")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Rather than writing custom CSS for your plugin, where possible apply Bootstrap classes to the DOM elements in your output. These will be easier to maintain and will adopt most colour, branding, and other customisations applied to a theme."))))}kt.isMDXComponent=!0;var bt=function(e){return i.createElement(o.nR,(0,a.Z)({refreshedDuringPurge:!0,defaultDescription:kt,filepath:"/styles.css",summary:"CSS style sheet for your plugin"},e))},Nt=["components"],wt={},_t={toc:[]};function xt(e){var t=e.components,n=(0,r.Z)(e,Nt);return(0,l.kt)("wrapper",(0,a.Z)({},_t,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:wt},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Details of all third-party libraries should be declared in the ",(0,l.kt)("inlineCode",{parentName:"p"},"thirdpartylibs.xml")," file."),(0,l.kt)("p",null,"This information is used to generate ignore file configuration for linting tools. For Moodle core it is also used to generate library information as part of release notes and credits."),(0,l.kt)("p",null,"Within the XML the ",(0,l.kt)("inlineCode",{parentName:"p"},"location")," is a file, or directory, relative to your plugin's root."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Licensing")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The license of any third-party code included in your plugin, and within the ",(0,l.kt)("inlineCode",{parentName:"p"},"thirdpartylibs.xml")," file ",(0,l.kt)("strong",{parentName:"p"},"must")," be ",(0,l.kt)("a",{parentName:"p",href:"http://www.gnu.org/licenses/license-list.html#GPLCompatibleLicenses"},"compatible with the GNU GPLv3"),"."))),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Third_Party_Libraries"},"Third Party Libraries")," documentation for further information."))}xt.isMDXComponent=!0;var At=function(e){return i.createElement(o.nR,(0,a.Z)({defaultDescription:xt,defaultExample:'<?xml version="1.0"?>\n<libraries>\n    <library>\n        <location>javascript/html5shiv.js</location>\n        <name>Html5Shiv</name>\n        <version>3.6.2</version>\n        <license>Apache</license>\n        <licenseversion>2.0</licenseversion>\n    </library>\n    <library>\n        <location>vendor/guzzle/guzzle/</location>\n        <name>guzzle</name>\n        <version>v3.9.3</version>\n        <license>MIT</license>\n        <licenseversion></licenseversion>\n    </library>\n</libraries>',filepath:"/thirdpartylibs.xml",filetype:"xml",summary:"Details of third-party libraries includedin the plugin",showLicense:!1,showFileHeader:!1},e))},Mt=["components"],Et={},Tt={toc:[]};function It(e){var t=e.components,n=(0,r.Z)(e,Mt);return(0,l.kt)("wrapper",(0,a.Z)({},Tt,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Et},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"Each component and subsystem may make use of an ",(0,l.kt)("inlineCode",{parentName:"p"},"upgrade.txt")," file in the top level folder. A title is used to identify the Moodle version where the change was introduced, and significant changes for that version relating to that component or subsystem are displayed."),(0,l.kt)("p",null,"When changes are integrated to multiple branches, for example a stable version and the master branch, then the relevant versions used to describe the change in the ",(0,l.kt)("inlineCode",{parentName:"p"},"upgrade.txt")," file should be the next version to be released ",(0,l.kt)("em",{parentName:"p"},"for each branch"),". The ",(0,l.kt)("inlineCode",{parentName:"p"},"master")," branch should always use the next major version."),(0,l.kt)("p",null,"For example if a change is applied to the ",(0,l.kt)("strong",{parentName:"p"},"MOODLE_400_STABLE")," during the development of Moodle 4.0.2, and the ",(0,l.kt)("strong",{parentName:"p"},"master")," branch during the development of Moodle 4.1, then the relevant versions will be ",(0,l.kt)("strong",{parentName:"p"},"4.0.2")," and ",(0,l.kt)("strong",{parentName:"p"},"4.1"),"."),(0,l.kt)("p",null,"If a change is only applied to the master branch then only the ",(0,l.kt)("strong",{parentName:"p"},"4.1")," version will be listed."),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exception during parallel development")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"When Moodle is developing two major versions in parallel, for example Moodle 3.11.0, and Moodle 4.0.0, then the\nversion in the earliest of the major version development branches will be used for both branches."),(0,l.kt)("p",{parentName:"div"},"For example, during the development of Moodle 3.11, and Moodle 4.0, which took place in parallel, if a change was integrated to 3.11 and 4.0, then the version specified in both branches would be 3.11."))))}It.isMDXComponent=!0;var Lt=function(e){return i.createElement(o.nR,(0,a.Z)({recommended:!0,filepath:"/*/upgrade.txt",defaultDescription:It,summary:"Significant changes for each version of your plugin"},e))},Rt=["components"],Pt={},Ct={toc:[]};function Zt(e){var t=e.components,n=(0,r.Z)(e,Rt);return(0,l.kt)("wrapper",(0,a.Z)({},Ct,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:Pt},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"The version.php contains metadata about the plugin."),(0,l.kt)("p",null,"It is used during the installation and upgrade of the plugin."),(0,l.kt)("p",null,"This file contains metadata used to describe the plugin, and includes information such as:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the version number"),(0,l.kt)("li",{parentName:"ul"},"a list of dependencies"),(0,l.kt)("li",{parentName:"ul"},"the minimum Moodle version required"),(0,l.kt)("li",{parentName:"ul"},"maturity of the plugin")))}Zt.isMDXComponent=!0;function Dt(e){return i.createElement(o.nR,(0,a.Z)({required:!0,filepath:"/version.php",filetype:"php",summary:"Version metadata",examplePurpose:"Version metadata",defaultDescription:Zt,defaultExample:"defined('MOODLE_INTERNAL') || die();\n\n$plugin->version = TODO;\n$plugin->requires = TODO;\n$plugin->supported = TODO;   // Available as of Moodle 3.9.0 or later.\n$plugin->incompatible = TODO;   // Available as of Moodle 3.9.0 or later.\n$plugin->component = 'TODO_FRANKENSTYLE';\n$plugin->maturity = MATURITY_STABLE;\n$plugin->release = 'TODO';\n\n$plugin->dependencies = [\n    'mod_forum' => 2022042100,\n    'mod_data' => 2022042100\n];\n"},e))}var $t=["components"],St={},Ft={toc:[]};function Ot(e){var t=e.components,n=(0,r.Z)(e,$t);return(0,l.kt)("wrapper",(0,a.Z)({},Ft,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)(s.Z,(0,a.Z)({frontMatter:St},"undefined"!=typeof metadata?{metadata:metadata}:{},{mdxType:"MoodlePageBanner"})),(0,l.kt)("p",null,"In older versions of Moodle, JavaScript was written in the YUI format. This is being phased out in favour of ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Javascript_Modules"},"Javascript Modules"),", although some older uses still remain in Moodle core."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/YUI/Modules"},"YUI/Modules")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.moodle.org/dev/YUI"},"YUI"))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"New YUI code will not be accepted into Moodle core, except for new plugins for the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Atto"},"Atto editor"),"."))))}Ot.isMDXComponent=!0;var zt=function(e){return i.createElement(o.nR,(0,a.Z)({legacy:!0,refreshedDuringPurge:!0,defaultDescription:Ot,filepath:"/yui/",examplePurpose:"YUI JavaScript Modules",summary:"YUI JavaScript Modules"},e))}},85162:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(67294),i=n(86010),o="tabItem_Ymn6";function r(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(o,r),hidden:n},t)}},65488:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(83117),i=n(67294),o=n(86010),r=n(72389),l=n(67392),s=n(7094),p=n(12466),d="tabList__CuJ",u="tabItem_LNqP";function c(e){var t,n,r=e.lazy,c=e.block,m=e.defaultValue,h=e.values,f=e.groupId,g=e.className,v=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=h?h:v.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),k=(0,l.l)(y,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===m?m:null!=(t=null!=m?m:null==(n=v.find((function(e){return e.props.default})))?void 0:n.props.value)?t:v[0].props.value;if(null!==b&&!y.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+y.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=(0,s.U)(),w=N.tabGroupChoices,_=N.setTabGroupChoices,x=(0,i.useState)(b),A=x[0],M=x[1],E=[],T=(0,p.o5)().blockElementScrollPositionUntilNextRender;if(null!=f){var I=w[f];null!=I&&I!==A&&y.some((function(e){return e.value===I}))&&M(I)}var L=function(e){var t=e.currentTarget,n=E.indexOf(t),a=y[n].value;a!==A&&(T(t),M(a),null!=f&&_(f,String(a)))},R=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a,i=E.indexOf(e.currentTarget)+1;n=null!=(a=E[i])?a:E[0];break;case"ArrowLeft":var o,r=E.indexOf(e.currentTarget)-1;n=null!=(o=E[r])?o:E[E.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,o.Z)("tabs-container",d)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":c},g)},y.map((function(e){var t=e.value,n=e.label,r=e.attributes;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:A===t?0:-1,"aria-selected":A===t,key:t,ref:function(e){return E.push(e)},onKeyDown:R,onFocus:L,onClick:L},r,{className:(0,o.Z)("tabs__item",u,null==r?void 0:r.className,{"tabs__item--active":A===t})}),null!=n?n:t)}))),r?(0,i.cloneElement)(v.filter((function(e){return e.props.value===A}))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},v.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==A})}))))}function m(e){var t=(0,r.Z)();return i.createElement(c,(0,a.Z)({key:String(t)},e))}},32798:function(e){e.exports={siteHome:"https://moodle.academy/",courses:{setup:{id:29,name:"Set up your Moodle Development Environment",summary:"Learn about the Moodle developer community and setting up a development environment",description:"This course is designed for PHP developers who want to start developing Moodle plugins. You will learn about the Moodle developer community and set up a Moodle development environment. This is the first course in the Developer Pathway. Subsequent courses in the the Developer Pathway will build on the knowledge gained in this course.",tags:["development","basics","setup"],archived:!1,series:[]},securityEssentials:{id:53,name:"Moodle Access and Security Essentials",summary:"A short course looking at access control and security aspects of plugins.",description:"In this course we look at access control and security aspects of a plugin. Through a set of tutorials, you will learn how to control access to your plugin using Moodle's Access API. You will learn how to define capabilities in your plugin and how to determine if the user has the permission to access a page. This course also covers common security threats that developers need to be aware of.\n\nThis is the fourth course in the Moodle Developer Basics program.",tags:["development","basic","essentials","security","api"],archived:!1,series:["basics"]},outputEssentials:{id:49,name:"Web Output Essentials",summary:"Learn how to use Moodle's Page and Output APIs to display content in a local plugin.",description:"This course builds on the knowledge gained in the Moodle development environment course. In this course, we learn how to use Moodle's Page and Output APIs to display content in a local plugin. An introduction to localisation using language strings is also covered in this course. This is the second course in the Moodle developer pathway.",tags:["development","basics","essentials","output","api"],archived:!1,series:["basics"]},architecture:{id:51,name:"Moodle's Modular Architecture and APIs",summary:"Take a deeper look at Moodle's architecture, exploring common APIs including Navigations, Forms, Database, Upgrade, Strings, and Output.",description:"In this course we take a deeper look at Moodle's modular architecture and explore the use of common Moodle APIs. Some of the APIs covered in this course include: Navigation, Forms, Database access, Upgrade, Strings and Output APIs. Learners get hands-on practise on using these APIs in the form of developing a local plugin.\n\nThis is the third course in the Moodle Developer Basics program.",tags:["development","api","architecture"],archived:!1,series:["basics"]},pluginBasics:{id:10,name:"Moodle Plugin Development Basics",summary:"Learn about the essential concepts in Moodle's moduel architecture.",description:"This course teaches you essential concepts related to Moodle's modular architecture, enabling you to develop a simple demo plugin.\n\nPlease note, this course is being migrated to form a new program of short courses on Moodle Academy (called 'Moodle Developer Basics'), which will all be available at the end of April 2022. For now you may still complete the course on Learn Moodle, or you might like to start the Moodle Academy developer short courses that are being released over the coming weeks and will form this new beginner level program.",tags:["development","basics","essentials","api","plugins","architecture"],archived:!1,series:["basics"]}}}},50793:function(e,t,n){"use strict";n.d(t,{dn:function(){return A.Z},vL:function(){return x},U6:function(){return N},E2:function(){return M.Z},mQ:function(){return E.Z},Zh:function(){return _}});n(86134);var a=n(67294),i=n(87918),o=n(80102),r=n(83117),l=n(95408),s=n(98700),p=n(39707),d=n(59766),u=n(69348),c=n(54502),m=n(85893);const h=["component","direction","spacing","divider","children"];function f(e,t){const n=a.Children.toArray(e).filter(Boolean);return n.reduce(((e,i,o)=>(e.push(i),o<n.length-1&&e.push(a.cloneElement(t,{key:`separator-${o}`})),e)),[])}const g=(0,u.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>[t.root]})((({ownerState:e,theme:t})=>{let n=(0,r.Z)({display:"flex"},(0,l.k9)({theme:t},(0,l.P$)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const a=(0,s.hB)(t),i=Object.keys(t.breakpoints.values).reduce(((t,n)=>(null==e.spacing[n]&&null==e.direction[n]||(t[n]=!0),t)),{}),o=(0,l.P$)({values:e.direction,base:i}),r=(0,l.P$)({values:e.spacing,base:i}),p=(t,n)=>{return{"& > :not(style) + :not(style)":{margin:0,[`margin${i=n?o[n]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[i]}`]:(0,s.NA)(a,t)}};var i};n=(0,d.Z)(n,(0,l.k9)({theme:t},r,p))}return n})),v=a.forwardRef((function(e,t){const n=(0,c.Z)({props:e,name:"MuiStack"}),a=(0,p.Z)(n),{component:i="div",direction:l="column",spacing:s=0,divider:d,children:u}=a,v=(0,o.Z)(a,h),y={direction:l,spacing:s};return(0,m.jsx)(g,(0,r.Z)({as:i,ownerState:y,ref:t},v,{children:d?f(u,d):u}))}));var y=v,k=n(39960);function b(e,t,n){var o=function(e){return"number"==typeof e&&Number.isInteger(e)?e.toFixed(1):e}(t),r=a.createElement("span",null,function(e){if("since"===e)return"Since";if("deprecated"===e)return"Deprecated";throw new Error("Unknown <Since> type: '"+e+"'")}(e)," ",o),l=a.createElement(i.Z,{key:"chip-"+e+o,label:r,clickable:!!n});return n?a.createElement(k.Z,{to:"https://tracker.moodle.org/browse/"+n,key:"link-"+e+o},l):l}function N(e){var t,n,i,o,r,l,s,p,d,u=(n=(t=e).issueNumber,i=void 0===n?null:n,o=t.type,r=void 0===o?"since":o,l=t.versions,s=void 0===l?[]:l,p=t.version,(d=void 0===p?null:p)?b(r,d,i):s.map((function(e){return b(r,e,i)})));return a.createElement(y,{direction:"row",justifyContent:"flex-end",spacing:2},u)}var w=n(86010);function _(e){return a.createElement("div",{className:(0,w.Z)(" alert alert--success margin-bottom--lg ")},a.createElement("span",{className:(0,w.Z)(" badge badge--success ")},"An example of correct behaviour"),e.children)}function x(e){return a.createElement("div",{className:(0,w.Z)(" alert alert--danger margin-bottom--lg ")},a.createElement("span",{className:(0,w.Z)(" badge badge--danger ")},"An example of incorrect behaviour"),e.children)}n(80069);var A=n(46975),M=n(85162),E=n(65488)},86134:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(67294),i=n(69119),o=n(39960),r=n(88698),l=n(32798),s=n.n(l),p=n(80684);function d(e){var t=e.courseName;if(!s().courses[t])throw Error("Unknown course "+t);var n=s().courses[t];return a.createElement(i.Z,{type:"info",icon:a.createElement(r.Z,{fontSize:"inherit"}),title:"Learn more on Moodle Academy"},"You can learn more about"," ",a.createElement("strong",null,e.subject)," ","from the"," ",a.createElement(p.Z,{title:n.summary},a.createElement(o.Z,{to:s().siteHome+"course/view.php?id="+n.id},n.name))," ","on Moodle Academy.")}},80069:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(67294),i=n(87918),o=n(80684),r=n(86886),l=n(34673),s=n(3905),p=function(e,t,n){return void 0===n&&(n="info"),a.createElement(r.ZP,{item:!0,key:e},a.createElement(o.Z,{title:t},a.createElement(i.Z,{label:e,color:n})))};function d(e){var t=e.filepath,n=e.summary,i=function(e){var t=e.required,n=void 0!==t&&t,a=e.legacy,i=void 0!==a&&a,o=e.deprecated,r=void 0!==o&&o,l=e.refreshedDuringUpgrade,s=void 0!==l&&l,d=e.refreshedDuringPurge,u=void 0!==d&&d,c=[];return s&&c.push(p("Upgradable","Changes to this file or directory will be re-applied during a Moodle upgrade. If you make any changes to it, you can simply increment the version number and perform a Moodle upgrade.","info")),u&&c.push(p("Refreshed on cache purge","The contents of this file or directory are cached. To see your changes you can simply purge Moodle's caches and refresh the page.","info")),n&&c.push(p("Required","This file must be present","success")),i&&c.push(p("Legacy","Use of this file is being phased out. It is still supported for older installations but will be removed..","warning")),r&&c.push(p("Deprecated","Use of this file is deprecated and not recommended.It may still be provided for older versions of Moodle but is no longer used.","error")),c}(e),o=e.description?a.createElement(r.ZP,{item:!0,xs:12},e.description):null;return a.createElement(s.Zo,null,a.createElement(r.ZP,{container:!0,spacing:2},a.createElement(r.ZP,{item:!0,xs:6},a.createElement("h4",null,n)),a.createElement(r.ZP,{item:!0,xs:6},a.createElement(r.ZP,{container:!0,spacing:2,justifyContent:"flex-end"},i)),a.createElement(r.ZP,{item:!0,xs:12},a.createElement("h5",null,"File path:"," ",t)),o,function(e){var t=e.example,n=e.open,i=void 0!==n&&n;return t?a.createElement(r.ZP,{item:!0,xs:12},a.createElement(l.Z,{summary:a.createElement("summary",null,"View example"),open:i},t)):null}(e)))}},78989:function(e,t,n){"use strict";n.d(t,{W7:function(){return c}});var a,i=n(67294),o=n(46975),r=JSON.parse('{"plugintypes":{"antivirus":"lib/antivirus","availability":"availability/condition","qtype":"question/type","mod":"mod","auth":"auth","calendartype":"calendar/type","customfield":"customfield/field","enrol":"enrol","message":"message/output","block":"blocks","media":"media/player","filter":"filter","editor":"lib/editor","format":"course/format","dataformat":"dataformat","profilefield":"user/profile/field","report":"report","coursereport":"course/report","gradeexport":"grade/export","gradeimport":"grade/import","gradereport":"grade/report","gradingform":"grade/grading/form","mlbackend":"lib/mlbackend","mnetservice":"mnet/service","webservice":"webservice","repository":"repository","portfolio":"portfolio","search":"search/engine","qbank":"question/bank","qbehaviour":"question/behaviour","qformat":"question/format","plagiarism":"plagiarism","tool":"admin/tool","cachestore":"cache/stores","cachelock":"cache/locks","fileconverter":"files/converter","contenttype":"contentbank/contenttype","theme":"theme","local":"local","h5plib":"h5p/h5plib","paygw":"payment/gateway"},"subsystems":{"access":null,"admin":"admin","adminpresets":"admin/presets","analytics":"analytics","antivirus":"lib/antivirus","auth":"auth","availability":"availability","backup":"backup/util/ui","badges":"badges","block":"blocks","blog":"blog","bulkusers":null,"cache":"cache","calendar":"calendar","cohort":"cohort","comment":"comment","competency":"competency","completion":"completion","contentbank":"contentbank","countries":null,"course":"course","courseformat":"course/format","currencies":null,"customfield":"customfield","dbtransfer":null,"debug":null,"editor":"lib/editor","edufields":null,"enrol":"enrol","error":null,"favourites":"favourites","filepicker":null,"fileconverter":"files/converter","files":"files","filters":"filter","form":"lib/form","grades":"grade","grading":"grade/grading","group":"group","help":null,"hub":null,"h5p":"h5p","imscc":null,"install":null,"iso6392":null,"langconfig":null,"license":null,"mathslib":null,"media":"media","message":"message","mimetypes":null,"mnet":"mnet","my":"my","notes":"notes","pagetype":null,"payment":"payment","pix":null,"plagiarism":"plagiarism","plugin":null,"portfolio":"portfolio","privacy":"privacy","question":"question","rating":"rating","reportbuilder":"reportbuilder","repository":"repository","rss":"rss","role":"admin/roles","search":"search","table":"lib/table","tag":"tag","timezones":null,"user":"user","userkey":"lib/userkey","webservice":"webservice","xapi":"lib/xapi"}}'),l=function(e){return function(t){var n=t.plugintype,a=void 0===n?"plugintype":n,i=t.pluginname,o=void 0===i?"pluginname":i,r=t.filepath,l=void 0===r?null:r,s=function(e){return function(t){return e.plugintypes[t]?e.plugintypes[t]:"[path/to/"+t+"]"}}(e)(a);return""+(s+=o?"/"+o:"/[pluginname]")+l}},s=l(r),p=(s(r),function(e){if(!e.showFileHeader)return"";switch(null==e?void 0:e.filetype){case"xml":return"";case"js":case"javascript":return function(e){var t=e.plugintype,n=void 0===t?"plugintype":t,a=e.pluginname,i=void 0===a?"pluginname":a,o=e.examplePurpose,r=e.modulename;if(!o)throw Error("Purpose must be specified");if(!r)throw Error("AMD Module name must be specified");return["/**"," * "+o+" for the "+n+"_"+i+" plugin."," *"," * @module   "+n+"_"+i+"/"+r," * @copyright Year, You Name <your@email.address>"," * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */",""].join("\n")}(e);default:return function(e){var t=e.plugintype,n=void 0===t?"plugintype":t,a=e.pluginname,i=void 0===a?"pluginname":a,o=e.examplePurpose;if(!o)throw Error("Purpose must be specified");return["/**"," * "+o+" for the "+n+"_"+i+" plugin."," *"," * @package   "+n+"_"+i," * @copyright Year, You Name <your@email.address>"," * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */",""].join("\n")}(e)}}),d=function(e){return e.showLicense?(e.filetype,"// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n"):""},u=function(e){var t=e.filetype,n=void 0===t?"php":t;switch(n){case"js":case"javascript":return"javascript";case"xml":return"xml";case"php":case null:return"php";default:return n}},c=(a=r,function(e,t){var n,r=Object.assign({plugintype:"plugintype",showLicense:!0,showFileHeader:!0,filepath:null!=(n=e.exampleFilepath)?n:e.filepath},e),s=l(a),c=function(e,t){void 0===t&&(t=null);var n=[d(e),p(e),e.example?e.example:t||null].filter((function(e){return e})).map((function(e){return e.trim()})).join("\n\n");return[function(e){var t=e.filetype;switch(void 0===t?"php":t){case"js":case"javascript":case"xml":return null;default:return"<?php"}}(e),n].filter((function(e){return e})).join("\n")}(r,t);return i.createElement(o.Z,{title:s(r),language:u(r)},c)})},63641:function(e,t,n){"use strict";n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return u},default:function(){return v},frontMatter:function(){return d},langExample:function(){return h},metadata:function(){return c},toc:function(){return f}});var a=n(83117),i=n(80102),o=(n(67294),n(3905)),r=n(13904),l=n(95757),s=n(50793),p=["components"],d={title:"Repository plugins",tags:["Repositories","Plugins"]},u=void 0,c={unversionedId:"apis/plugintypes/repository/index",id:"apis/plugintypes/repository/index",title:"Repository plugins",description:"Repository plugin allow Moodle to bring contents into Moodle from external repositories.",source:"@site/docs/apis/plugintypes/repository/index.md",sourceDirName:"apis/plugintypes/repository",slug:"/apis/plugintypes/repository/",permalink:"/devdocs/docs/apis/plugintypes/repository/",draft:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/docs/apis/plugintypes/repository/index.md",tags:[{label:"Repositories",permalink:"/devdocs/docs/tags/repositories"},{label:"Plugins",permalink:"/devdocs/docs/tags/plugins"}],version:"current",lastUpdatedBy:"Sara Arjona",lastUpdatedAt:1654608238,formattedLastUpdatedAt:"07/06/2022",frontMatter:{title:"Repository plugins",tags:["Repositories","Plugins"]},sidebar:"docs",previous:{title:"Question Bank plugins",permalink:"/devdocs/docs/apis/plugintypes/qbank/"},next:{title:"Subsystems",permalink:"/devdocs/docs/category/subsystems"}},m={},h="\n$string['pluginname']= 'Example repository';\n$string['configplugin'] = 'Configuration for Example repository';\n$string['pluginname_help'] = 'A repository description';\n",f=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"File structure",id:"file-structure",level:2},{value:"version.php",id:"versionphp",level:3},{value:"lang/en/repository_pluginname.php",id:"langenrepository_pluginnamephp",level:3},{value:"lib.php",id:"libphp",level:3},{value:"db/access.php",id:"dbaccessphp",level:3},{value:"Repository API methods",id:"repository-api-methods",level:2},{value:"supported_returntypes(): int",id:"supported_returntypes-int",level:3},{value:"supported_filetypes()",id:"supported_filetypes",level:3},{value:"Course and User Repository Instances.",id:"course-and-user-repository-instances",level:3},{value:"Developer-defined API",id:"developer-defined-api",level:3},{value:"get_type_option_names(): array",id:"get_type_option_names-array",level:4},{value:"type_config_form($mform, $classname=&#39;repository&#39;)",id:"type_config_formmform-classnamerepository",level:4},{value:"type_form_validation($mform, $data, $errors)",id:"type_form_validationmform-data-errors",level:4},{value:"Instance settings",id:"instance-settings",level:3},{value:"get_instance_option_names(): array",id:"get_instance_option_names-array",level:4},{value:"instance_config_form($mform)",id:"instance_config_formmform",level:4},{value:"instance_form_validation($mform, $data, $errors)",id:"instance_form_validationmform-data-errors",level:4},{value:"Getting / updating settings",id:"getting--updating-settings",level:4},{value:"plugin_init()",id:"plugin_init",level:4},{value:"Example of using the settings",id:"example-of-using-the-settings",level:3},{value:"Repository APIs",id:"repository-apis",level:2},{value:"Quick Start",id:"quick-start",level:3},{value:"Functions you MUST override",id:"functions-you-must-override",level:3},{value:"__construct($respoitoryid, $context=SYSCONTEXTID, $options=array(), $readonly=0)",id:"__constructrespoitoryid-contextsyscontextid-optionsarray-readonly0",level:4},{value:"get_listing($path=&quot;&quot;, $page=&quot;&quot;)",id:"get_listingpath-page",level:4},{value:"Dynamically loading",id:"dynamically-loading",level:3},{value:"User login (optional)",id:"user-login-optional",level:3},{value:"print_login",id:"print_login",level:4},{value:"check_login(): bool",id:"check_login-bool",level:4},{value:"logout",id:"logout",level:4},{value:"Transferring files to Moodle (optional)",id:"transferring-files-to-moodle-optional",level:3},{value:"get_file_reference($source)",id:"get_file_referencesource",level:4},{value:"get_file($url, $filename = &quot;&quot;)",id:"get_fileurl-filename--",level:4},{value:"get_link($url)",id:"get_linkurl",level:4},{value:"get_file_source_info($source)",id:"get_file_source_infosource",level:4},{value:"Search functions (optional)",id:"search-functions-optional",level:3},{value:"print_search",id:"print_search",level:4},{value:"search($search_text, $page = 0)",id:"searchsearch_text-page--0",level:4},{value:"global_search()",id:"global_search",level:4},{value:"Repository support for returning file as alias/shortcut",id:"repository-support-for-returning-file-as-aliasshortcut",level:3},{value:"get_reference_file_lifetime()",id:"get_reference_file_lifetime",level:4},{value:"sync_individual_file(stored_file $storedfile)",id:"sync_individual_filestored_file-storedfile",level:4},{value:"get_reference_details($reference, $filestatus = 0)",id:"get_reference_detailsreference-filestatus--0",level:4},{value:"get_file_by_reference($reference)",id:"get_file_by_referencereference",level:4},{value:"send_file($storedfile, $lifetime=86400, $filter=0, $forcedownload=false, array $options = null)",id:"send_filestoredfile-lifetime86400-filter0-forcedownloadfalse-array-options--null",level:4}],g={langExample:h,toc:f};function v(e){var t=e.components,u=(0,i.Z)(e,p);return(0,o.kt)("wrapper",(0,a.Z)({},g,u,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(r.Z,(0,a.Z)({frontMatter:d},void 0!==c?{metadata:c}:{},{mdxType:"MoodlePageBanner"})),(0,o.kt)("p",null,"Repository plugin allow Moodle to bring contents into Moodle from external repositories."),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"Before starting coding, it is necessary to know how to use repository administration pages and how to use the file picker."),(0,o.kt)("p",null,"The 2 different parts to write in order to implement a full repository:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Administration - You can customise the way administrators and users can configure their repositories."),(0,o.kt)("li",{parentName:"ol"},"File picker integration - The core of your plugin, it will manage communication between Moodle and the repository service, and also the file picker display.")),(0,o.kt)("h2",{id:"file-structure"},"File structure"),(0,o.kt)("p",null,"Repository plugins are located in the ",(0,o.kt)("inlineCode",{parentName:"p"},"/repository")," directory."),(0,o.kt)("p",null,"Each plugin is in a separate subdirectory and consists of a number of ",(0,o.kt)("em",{parentName:"p"},"mandatory files")," and any other files the developer is going to use."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View an example directory layout for the `repository_pluginname` plugin."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"}," repository/pluginname/\n |-- db\n |   `-- access.php\n |-- lang\n |   `-- en\n |       `-- repository_pluginname.php\n |-- lib.php\n |-- pix\n |   `-- icon.png\n `-- version.php\n"))),(0,o.kt)("p",null,"Some of the important files for the repository plugintype are described below. See the ",(0,o.kt)("a",{parentName:"p",href:"../commonfiles"},"common plugin files")," documentation for details of other files which may be useful in your plugin."),(0,o.kt)("h3",{id:"versionphp"},"version.php"),(0,o.kt)(l.f_,{plugintype:"repository",mdxType:"VersionPHP"}),(0,o.kt)("h3",{id:"langenrepository_pluginnamephp"},"lang/en/repository_pluginname.php"),(0,o.kt)(l.Uo,{plugintype:"repository",pluginname:"pluginname",example:h,mdxType:"Lang"}),(0,o.kt)("h3",{id:"libphp"},"lib.php"),(0,o.kt)(l.Gf,{plugintype:"repository",pluginname:"pluginname",example:"defined('MOODLE_INTERNAL') || die();\n\nrequire_once($CFG->dirroot . '/repository/lib.php');\n\nclass repository_pluginname extends repository {\n    /**\n     * Get file listing.\n     *\n     * This is a mandatory method for any repository.\n     *\n     * See repository::get_listing() for details.\n     *\n     * @param string $encodedpath\n     * @param string $page\n     * @return array the list of files, including meta infomation\n     */\n    public function get_listing($encodedpath = '', $page = '') {\n        // This methods\n        return array('list' => []);\n    }\n\n    /**\n     * Is this repository used to browse moodle files?\n     *\n     * @return boolean\n     */\n    public function has_moodle_files() {\n        return true;\n    }\n\n    /**\n     * Tells how the file can be picked from this repository.\n     *\n     * @return int\n     */\n    public function supported_returntypes() {\n        return FILE_INTERNAL | FILE_REFERENCE;\n    }\n\n    /**\n     * Which return type should be selected by default.\n     *\n     * @return int\n     */\n    public function default_returntype() {\n        return FILE_INTERNAL;\n    }\n\n\n    /**\n     * Optional method for searching files in the repository.\n     *\n     * @param string $search\n     * @param int $page\n     * @return array the list of found files.\n     */\n    public function search($search, $page = 0) {\n        $ret = [];\n        $ret['nologin'] = true;\n        // The found files list.\n        $ret['list'] = [];\n        return $ret;\n    }\n}\n",legacy:!1,required:!0,mdxType:"Lib"},(0,o.kt)("p",null,"This file contains the main repository class definition, which must extend the core ",(0,o.kt)("inlineCode",{parentName:"p"},"\\repository")," class. By extending the base class and overriding some of the class methods, the plugin can configure standard features and behaviours. See ",(0,o.kt)("a",{parentName:"p",href:"#administration-apis"},"Administration API")," for more information.")),(0,o.kt)("h3",{id:"dbaccessphp"},"db/access.php"),(0,o.kt)(l.MC,{plugintype:"repository",pluginname:"pluginname",example:"\n$capabilities = [\n    // Ability to use the plugin.\n    'repository/pluginname:view' => [\n        'captype' => 'read',\n        'contextlevel' => CONTEXT_MODULE,\n        'archetypes' => [\n            'coursecreator' => CAP_ALLOW,\n            'editingteacher' => CAP_ALLOW,\n            'manager' => CAP_ALLOW\n        ]\n    ],\n];\n",mdxType:"DbAccessPHP"}),(0,o.kt)("h2",{id:"repository-api-methods"},"Repository API methods"),(0,o.kt)("p",null,"Repository plugins can present, store, and link files in different ways depending on the type of remote system that the repository connects to."),(0,o.kt)("p",null,"Some of the key API functions are described below."),(0,o.kt)("h3",{id:"supported_returntypes-int"},"supported_returntypes(): int"),(0,o.kt)("p",null,"Return any combination of the following values:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FILE_INTERNAL")," - the file is stored within the Moodle file system."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FILE_EXTERNAL")," - the file is stored in the external repository. It is not stored within the Moodle file system. When accessing the file it is returned from the remote system."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FILE_REFERENCE")," - the file stays in the external repository but may be cached locally. In that case it should be synchronised automatically, as required, with any changes to the external original."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FILE_CONTROLLED_LINK")," - the file remains in the external repository, and ownership of the file in the remote system is changed to the ",(0,o.kt)("a",{parentName:"li",href:"https://docs.moodle.org//en/OAuth_2_services"},"system account in the external repository"),". When the file is accessed, the system account is responsible for granting access to users.")),(0,o.kt)(s.mQ,{mdxType:"Tabs"},(0,o.kt)(s.E2,{value:"options",label:"Setting options example",default:!0,mdxType:"TabItem"},(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The return types that your plugin supports will be presented as options to the user when they are adding a file from the file picker. The ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL")," option is not reflected in this list as this is an internal feature of your API."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("img",{alt:"Supported returntypes options settings",src:n(2861).Z,width:"347",height:"93"})))),(0,o.kt)(s.E2,{value:"code",label:"View code",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"function supported_returntypes() {\n    return FILE_INTERNAL | FILE_EXTERNAL | FILE_REFERENCE | FILE_CONTROLLED_LINK;\n}\n")))),(0,o.kt)("p",null,"The return values influence the choices offered to a user when selecting a file in file picker. Consider the screenshot above, which is from the dialogue that appears directly after choosing (but before uploading) a file in mod_resource. The three options result from ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_INTERNAL"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_REFERENCE"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_CONTROLLED_LINK")," being present. ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_REFERENCE"),' corresponds to the "alias/shortcut" option.'),(0,o.kt)("p",null,"The option ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL")," is never reflected in the file picker for mod_resource, so its absence or presence in supported_returntypes() is never reflected here. However, ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL")," is the only return type supported by mod_url: For mod_url, file picker will only(!) list repositories that support ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL"),"."),(0,o.kt)("p",null,"This implies that a plugin that uses a file picker is able to narrow the set of supported return types. For example, assignsubmission_file disallows ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_REFERENCE"),"."),(0,o.kt)("p",null,"In the end, which type is\nused by Moodle depends on the choices made by the end user (for example inserting a link, will result in ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL"),"-related functions being used, using a 'shortcut/alias' will result in the '",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_REFERENCE"),"'-related functions being used)."),(0,o.kt)("h3",{id:"supported_filetypes"},"supported_filetypes()"),(0,o.kt)("p",null,"If your plugin only supports certian file types, then you should implement the optional ",(0,o.kt)("inlineCode",{parentName:"p"},"supported_filetypes()")," method."),(0,o.kt)("p",null,"This method is used to hide repositories when they don't support certain file types - for example, if a user is inserting a video then any repository which does not support videos will not be shown."),(0,o.kt)("p",null,"Supported file types can be specified using standard mimetypes (such as ",(0,o.kt)("inlineCode",{parentName:"p"},"image/gif"),") or file groups (such as ",(0,o.kt)("inlineCode",{parentName:"p"},"web_image"),"). For a full list of the supported mimetypes and groups, see the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/moodle/moodle/blob/v4.0.0/lib/classes/filetypes.php#L47"},(0,o.kt)("inlineCode",{parentName:"a"},"core_filetypes"))," class."),(0,o.kt)(s.mQ,{mdxType:"Tabs"},(0,o.kt)(s.E2,{value:"all",label:"All files",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"function supported_filetypes() {\n    // Allow any kind of file.\n    return '*';\n}\n"))),(0,o.kt)(s.E2,{value:"mimetypes",label:"Filter mimetypes",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"function supported_filetypes() {\n    // Example of image mimetypes.\n    return ['image/gif', 'image/jpeg', 'image/png'];\n}\n"))),(0,o.kt)(s.E2,{value:"groups",label:"Filter file groups",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"function supported_filetypes() {\n    // Example of a file group.\n    return ['web_image'];\n}\n")))),(0,o.kt)("h3",{id:"course-and-user-repository-instances"},"Course and User Repository Instances."),(0,o.kt)("p",null,"A system-wide instance of a repository is created when it is enabled. It is also possible to support both course, and user specific repositories.. This can be achieved by setting the  ",(0,o.kt)("inlineCode",{parentName:"p"},"enablecourseinstances")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"enableuserinstances")," options.  There are three ways that this can be done:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Define ",(0,o.kt)("strong",{parentName:"li"},"$string","[","'enablecourseinstances'","]")," and ",(0,o.kt)("strong",{parentName:"li"},"$string","[","'enableuserinstances'","]")," in your plugin's language file. You can check an example in the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/moodle/moodle/blob/v4.0.0/repository/filesystem/lang/en/repository_filesystem.php"},"filesystem repository"),"."),(0,o.kt)("li",{parentName:"ol"},"The plugin must provide a ",(0,o.kt)("strong",{parentName:"li"},"get_instance_option_names")," method which returns at least one instance option name. This method defined the specific instances options, if none instance atrtribute is needed, the system will not allow the plguin to define course and user instances. Note, you must not define the form fields for these options in the ",(0,o.kt)("strong",{parentName:"li"},"type_config_form()")," function. For example, ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/moodle/moodle/blob/v4.0.0/repository/filesystem/lib.php#L439"},"filesystem repository"),"."),(0,o.kt)("li",{parentName:"ol"},"Several 'core' repositories use the ",(0,o.kt)("strong",{parentName:"li"},"db/install.php")," to create the original repository instance by constructing an instance of the ",(0,o.kt)("strong",{parentName:"li"},"repository_type")," class.  The options can be defined in the array passed as the second parameter to the constructor. For example ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/moodle/moodle/blob/v4.0.0/repository/wikimedia/db/install.php"},"Wikipedia repository"),".")),(0,o.kt)("h3",{id:"developer-defined-api"},"Developer-defined API"),(0,o.kt)("p",null,"These are settings that are configured for the whole Moodle site and not per instance of your plugin. All of these are optional, without them there will be no configuration options in the Site administration > Plugins > Repositories > pluginname page."),(0,o.kt)("h4",{id:"get_type_option_names-array"},"get_type_option_names(): array"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,"Optional. Return an array of string. These strings are setting names. These settings are shared by all instances.\nParent function returns an array with a single item - pluginname."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function get_type_option_names() {\n   return array_merge(parent::get_type_option_names(), ['rootpath']);\n}\n")))),(0,o.kt)("h4",{id:"type_config_formmform-classnamerepository"},"type_config_form($mform, $classname='repository')"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,"Optional. This is for modifying the Moodle form displaying the plugin settings. The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/lib/formslib.php_Form_Definition"},"Form Definition")," documentation has details of all the types of elements you can add to the settings form."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("p",null,"For example, to display the standard repository plugin settings along with the custom ones use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function type_config_form($mform, $classname='repository') {\n    parent::type_config_form($mform);\n\n    $rootpath = get_config('repository_pluginname', 'rootpath');\n    $mform->addElement('text', 'rootpath', get_string('rootpath', 'repository_pluginname'), array('size' => '40'));\n    $mform->setDefault('rootpath', $rootpath);\n}\n")))),(0,o.kt)("h4",{id:"type_form_validationmform-data-errors"},"type_form_validation($mform, $data, $errors)"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,'Optional. Use this function if you need to validate some variables submitted by plugin settings form. To use it, check through the associative array of data provided (\'settingname\' => value) for any errors. Then push the items to $error array in the format ("fieldname" => "human readable error message") to have them highlighted in the form.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function type_form_validation($mform, $data, $errors) {\n    if (!is_dir($data['rootpath'])) {\n        $errors['rootpath'] = get_string('invalidrootpath', 'repository_pluginname');\n    }\n    return $errors;\n}\n")),(0,o.kt)("h3",{id:"instance-settings"},"Instance settings"),(0,o.kt)("p",null,"These functions relate to a specific instance of your plugin (for example the URL and login details to access a specific webdav repository). All of these are optional, without them, the instance settings form will only contain a single 'name' field."),(0,o.kt)("h4",{id:"get_instance_option_names-array"},"get_instance_option_names(): array"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,"Optional. Return an array of strings. These strings are setting names. These settings are specific to an instance."),(0,o.kt)("p",null,"If the function returns an empty array, the API will consider that the plugin displays only one repository in the file picker."),(0,o.kt)("p",null,"Parent function returns an empty array. This is equivalent to ",(0,o.kt)("strong",{parentName:"p"},"get_type_option_names()"),", but for a specific instance."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function get_instance_option_names() {\n    return ['fs_path']; // From repository_filesystem\n}\n")))),(0,o.kt)("h4",{id:"instance_config_formmform"},"instance_config_form($mform)"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,"Optional. This is for modifying the Moodle form displaying the settings specific to an instance. This is equivalent to ",(0,o.kt)("strong",{parentName:"p"},"type_config_form($mform, $classname)")," but for instances. The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/lib/formslib.php_Form_Definition"},"Form Definition")," documentation has details of all the types of elements you can add to the settings form."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("p",null,"For example, to add a required text box called email_address:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function get_instance_option_names() {\n    $mform->addElement(\n        'text',\n        'email_address',\n        get_string('emailaddress', 'repository_pluginname')\n    );\n    $mform->addRule('email_address', $strrequired, 'required', null, 'client');\n}\n")))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"mform")," has by default a name text box (cannot be removed)."))),(0,o.kt)("h4",{id:"instance_form_validationmform-data-errors"},"instance_form_validation($mform, $data, $errors)"),(0,o.kt)("p",null,"This function must be declared static"),(0,o.kt)("p",null,"Optional. This allows us to validate what has been submitted in the instance configuration form. This is equivalent to ''type_form_validation($mform, $data, $errors), but for instances. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public static function instance_form_validation($mform, $data, $errors) {\n    if (empty($data['email_address'])) {\n        $errors['email_address'] = get_string('invalidemailsettingname', 'repository_flickr_public');\n    }\n}\n")),(0,o.kt)("h4",{id:"getting--updating-settings"},"Getting / updating settings"),(0,o.kt)("p",null,"Both global and instance settings can be retrieved, from within the plugin, via ",(0,o.kt)("strong",{parentName:"p"},"$this->get_option('settingname')")," and updated via ",(0,o.kt)("strong",{parentName:"p"},"$this->set_option(array('settingname' => 'value'))"),"."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You cannot call ",(0,o.kt)("strong",{parentName:"p"},"$this")," from static methods.  If you need access the non static variables, you may have to store the values in the ",(0,o.kt)("strong",{parentName:"p"},"_construct()")," method into private static variables."))),(0,o.kt)("h4",{id:"plugin_init"},"plugin_init()"),(0,o.kt)("p",null,"This function must be declared static."),(0,o.kt)("p",null,"Optional. This function is called when the administrator adds the plugin. So unless the administrator deletes the plugin and re-adds it, it should be called only once."),(0,o.kt)("p",null,"Parent function does nothing."),(0,o.kt)("h3",{id:"example-of-using-the-settings"},"Example of using the settings"),(0,o.kt)("p",null,'As an example, let\'s create a Flickr plugin for accessing a public flickr account. The plugin will be called "Flickr Public".'),(0,o.kt)("p",null,"Firstly the skeleton:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="repository/flickr_public/lib.php"',title:'"repository/flickr_public/lib.php"'},"<?php\n/**\n * repository_flickr_public class\n * Moodle user can access public flickr account\n *\n * @license http://www.gnu.org/copyleft/gpl.html GNU Public License\n*/\nclass repository_flickr_public extends repository {\n}\n")),(0,o.kt)("p",null,'Then consider the question "What does my plugin do?"'),(0,o.kt)("p",null,"In the Moodle file picker, we want to display some flickr public repositories directly linked to a flickr public account. For example ",(0,o.kt)("strong",{parentName:"p"},"My Public Flickr Pictures"),", and also ''My Friend's Flickr Pictures''. When the user clicks on one of these repositories, the public pictures are displayed in the file picker."),(0,o.kt)("p",null,'In order to access to a flickr public account, the plugin needs to know the email address of the Flickr public account owner. So the administrator will need to set an email address for every repository. Let\'s add an "email address" setting to every repository. To do so you need to override:'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"get_instance_option_names")," returing ","['email_address']","."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"instance_config_form")," adding a text box called 'email_address' into the form.")),(0,o.kt)("p",null,"So at this moment all our Flickr Public Repositories will have a specific email address. However this is not enough. In order to communicate with Flickr, Moodle needs to know a Flickr API key (",(0,o.kt)("a",{parentName:"p",href:"http://www.flickr.com/services/api/"},"http://www.flickr.com/services/api/"),"). This API key is the same for any repository. We could add it with the email address setting but the administrator would have to enter the same API key for every repository. Hopefully the administrator can add settings to the plugin level, impacting all repositories. To do so you need to override:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"get_type_option_names")," returing ","['api_key']","."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"type_config_form")," adding the api_key text input element into the form.")),(0,o.kt)("p",null,"At this point we have created everything necessary for the administration pages. But let's go further. It would be good if the user can enter any \"Flickr public account email address\" in the file picker. In fact we want to display in the file picker a Flickr Public repository that the Moodle administrator can never delete. Let's add:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"plugin_init")," using ",(0,o.kt)("strong",{parentName:"li"},"repository::static_function")," to create a default repository instance.")),(0,o.kt)("p",null,"That's all - the administration part of our Flickr Public plugin is done. For your information, Box.net, Flickr, and Flickr Public all have similar administration APIs."),(0,o.kt)(l.Gf,{plugintype:"repository",pluginname:"pluginname",example:"defined('MOODLE_INTERNAL') || die();\n\nrequire_once($CFG->dirroot . '/repository/lib.php');\n\nclass repository_flickr_public extends repository {\n\n    // User specific settings.\n\n    /**\n     * Options names.\n     *\n     * Tell the API that the repositories have specific settings: \"email address\"\n     *\n     * @return string[] of options.\n     */\n    public static function get_instance_option_names() {\n        return ['email_address'];\n    }\n\n    /**\n     * Repository configuration form.\n     *\n     * Add an \"email address\" text box to the create/edit repository instance Moodle form\n     *\n     * @param moodleform $mform Moodle form\n     */\n    public static function instance_config_form($mform) {\n        $mform->addElement(\n            'text',\n            'email_address',\n            get_string('emailaddress', 'repository_flickr_public')\n        );\n        $mform->addRule(\n            'email_address',\n            get_string('required'),\n            'required',\n            null,\n            'client'\n        );\n    }\n\n    // Global repository plugin settings.\n\n    /**\n     * Repository global settings names.\n     *\n     * We tell the API that the repositories have general settings: \"api_key\"\n     *\n     * @return string[] of options.\n     */\n    public static function get_type_option_names() {\n        return array('api_key');\n    }\n\n    /**\n     * Repository global settings form.\n     *\n     * We add an \"api key\" text box to the create/edit repository plugin Moodle form (also called a Repository type Moodle form)\n     *\n     * @param moodleform $mform Moodle form\n     */\n    public function type_config_form($mform) {\n        //the following line is needed in order to retrieve the API key value from the database when Moodle displays the edit form\n        $api_key = get_config('flickrpublic', 'api_key');\n\n        $mform->addElement(\n            'text',\n            'api_key',\n            get_string('apikey', 'repository_flickr_public'),\n            ['value' => $api_key, 'size' => '40']\n        );\n        $mform->addRule(\n            'api_key',\n            get_string('required'),\n            'required',\n            null,\n            'client'\n        );\n    }\n\n    // Method called when the repostiroy plugin is installed.\n\n    /**\n     * Plugin init method.\n     *\n     * this function is only called one time, when the Moodle administrator add the Flickr Public Plugin into the Moodle site.\n     */\n    public static function plugin_init() {\n        //here we create a default repository instance. The last parameter is 1 in order to set the instance as readonly.\n        repository::static_function(\n            'flickrpublic',\n            'create',\n            'flickrpublic',\n            0,\n            context_system::instance(),\n            ['name' => 'default instance', 'email_address' => null],\n            1\n        );\n    }\n}\n",legacy:!1,summary:!1,description:"",mdxType:"Lib"}),(0,o.kt)("h2",{id:"repository-apis"},"Repository APIs"),(0,o.kt)("h3",{id:"quick-start"},"Quick Start"),(0,o.kt)("p",null,"The File Picker uses Ajax calls to present the repository content. In order to integrate a repository with the the Ajax callbacks there are several possibilities:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"When a plugin requires a special user login (for example OAuth) the plugin must detect user session in the ",(0,o.kt)("inlineCode",{parentName:"li"},"constructor()")," function, and use ",(0,o.kt)("inlineCode",{parentName:"li"},"print_login()")," if required."),(0,o.kt)("li",{parentName:"ul"},"For plugins that need to connect to a remote repository the connections can be done into the ",(0,o.kt)("inlineCode",{parentName:"li"},"get_listing()")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"constructor()")," function."),(0,o.kt)("li",{parentName:"ul"},"To retrieve the file that the user selected from a remote server, the plugin must rewrite the ",(0,o.kt)("inlineCode",{parentName:"li"},"get_file()")," method."),(0,o.kt)("li",{parentName:"ul"},"To provide search feature the plugin must rewrite the ",(0,o.kt)("inlineCode",{parentName:"li"},"search()")," method.")),(0,o.kt)("p",null,"All those methods are descrived below."),(0,o.kt)("h3",{id:"functions-you-must-override"},"Functions you MUST override"),(0,o.kt)("p",null,"These functions cover the basics of initialising your plugin each time the repository is accessed and listing the files available to the user from within the plugin."),(0,o.kt)("h4",{id:"__constructrespoitoryid-contextsyscontextid-optionsarray-readonly0"},"__construct($respoitoryid, $context=SYSCONTEXTID, $options=array(), $readonly=0)"),(0,o.kt)("p",null,"Should be overridden to do any initialisation required by the repository, including:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"logging in via optional_param, if required - see 'print_login', below"),(0,o.kt)("li",{parentName:"ul"},"getting any options from the database")),(0,o.kt)("p",null,"The possible items in the $options array are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"'ajax' - bool, true if the user is using the AJAX filepicker"),(0,o.kt)("li",{parentName:"ul"},"mimetypes' - array of accepted mime types, or '","*","' for all types")),(0,o.kt)("p",null,"Calling parent::","_","_construct($repositoryid, $context, $options, $readonly); is essential and will set up various required member variables:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"this->id - the repository instance id (the ID of the entry in mdl_repository_instances)"),(0,o.kt)("li",{parentName:"ul"},"this->context - the context in which the repository instance can be found"),(0,o.kt)("li",{parentName:"ul"},"this->instance - the repository instance record (from mdl_repository_instances)"),(0,o.kt)("li",{parentName:"ul"},"this->readonly - whether or not the settings can be changed"),(0,o.kt)("li",{parentName:"ul"},"this->options - the above options, combined with the settings saved in the database"),(0,o.kt)("li",{parentName:"ul"},"this->name - as specified by $this->get_name()"),(0,o.kt)("li",{parentName:"ul"},"this->returntypes - as specified by $this->supported_returntypes()")),(0,o.kt)("h4",{id:"get_listingpath-page"},'get_listing($path="", $page="")'),(0,o.kt)("p",null,"This function will return a list of files to be displayed to the user, the list must be a array."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"/**\n * Get file listing.\n *\n * This is a mandatory method for any repository.\n *\n * See repository::get_listing() for details.\n *\n * @param string $encodedpath\n * @param string $page\n * @return array the list of files, including meta infomation\n */\npublic function get_listing($encodedpath = '', $page = '') {\n    // This methods\n    return [\n        //this will be used to build navigation bar.\n        'path'=>[\n            [\n                'name'=>'root'\n                'path'=>'/'\n            ],\n            [\n                'name'=>'subfolder',\n                'path'=>'/subfolder'\n            ],\n        ],\n        'manage'=>'http://webmgr.moodle.com',\n        'list'=> [\n            [\n                'title'=>'filename1',\n                'date'=>'1340002147',\n                'size'=>'10451213',\n                'source'=>'http://www.moodle.com/dl.rar',\n            ],\n            [\n                'title'=>'folder',\n                'date'=>'1340002147',\n                'size'=>'0',\n                'children'=>[],\n            ],\n        ],\n    ];\n}\n")))),(0,o.kt)("p",null,"Amongst other details, this returns a ",(0,o.kt)("strong",{parentName:"p"},"title")," for each file (to be displayed in the filepicker) and the ",(0,o.kt)("strong",{parentName:"p"},"source")," for the file (which will be included in the request to 'download' the file into Moodle or to generate a link to the file). Directories return a ",(0,o.kt)("strong",{parentName:"p"},"children")," value, which is either an empty array (if 'dynload' is specified) or an array of the files and directories contained within it."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"The full specification of list element"),(0,o.kt)("div",null,(0,o.kt)(s.dn,{language:"json",mdxType:"CodeBlock"},'// Example of a list array with all the element types.\n{\n    // \'path\' is used to build navigation bar to show the current folder, so you need to include all parents folders\n    // array(array(\'name\'=>\'root\',\'path\'=>\'/\'), array(\'name\'=>\'subfolder\', \'path\'=>\'/subfolder\'))\n    // This will result in: /root/subfolder as current directory\n    "path": (array), // this will be used to build navigation bar,\n\n    // \'dynload\' tells file picker to fetch list dynamically.\n    // When user clicks the folder, it will send a ajax request to server side.\n    // Default value is false but note that non-Javascript file picker always acts as if dynload was set to true\n    "dynload": (bool), // use dynamic loading,\n\n    // If you are using pagination, \'page\' and \'pages\' parameters should be set.\n    // It is not recommended to use pagination and subfolders at the same time, the tree view mode can not handle it correctly\n    "page": (int), // which page is this list,\n    "pages": (int), // how many pages. If number of pages is unknown but we know that the next page exists repository may return -1,\n    "manage": (string), // url to file manager for the external repository, if specified will display link in file picker,\n    "help": (string), // url to the help window, if specified will display link in file picker,\n    "nologin": (bool), // requires login, default false, if set to true the login link will be removed from file picker,\n    "norefresh": (bool), // no refresh button, default false,\n    "logouttext": (string), // in case of nologin=false can substitute the text \'Logout\' for logout link in file picker,\n    "nosearch": (bool), // no search link, default false, if set to true the search link will be removed from file picker,\n    "issearchresult": (bool), // tells that this listing is the result of search,\n    // for repositories that actually upload a file: set \'upload\' option to display an upload form in file picker\n    "upload": { // upload manager\n        "label": (string), // label of the form element,\n        "id": (string) // id of the form element,\n    },\n    // \'list\' is used by file picker to build a file/folder tree\n    "list": {\n        { // file\n            "title": (string), // file name,\n            "shorttitle": (string), // optional, if you prefer to display a short title\n            "date": (int), // UNIX timestamp, default value for datemodified and datecreated,\n            "datemodified": (int), // UNIX timestamp when the file was last modified [      \'datecreated\' => (int) UNIX timestamp when the file was last created [2.3+](2.3+],\n            "size": (int), // file size in bytes,\n            "thumbnail": (string), // url to thumbnail for the file,\n            "thumbnail_width": (int), // the width of the thumbnail image,\n            "thumbnail_height": (int), // the height of the thumbnail image,\n            "source": (string), // plugin-dependent unique path to the file (id, url, path, etc.),\n            "url": (moodle_url), // the accessible url of file,\n            "icon": (string), // url to icon of the image (24x24px), if omitted the moodle filetype icon will be used [      \'realthumbnail\' => (string) url to image preview to be lazy-loaded when scrolled to it (if it requires to be generated and can not be returned as \'thumbnail\') [2.3+](2.3+],\n            "realicon": (string), // url to image preview in icon size (24x24) [      \'author\' => (string) default value for file author,\n            "license": (string), // default value for license (short name, see class license_manager),\n            "image_height": (int), // if the file is an image, image height in pixels, null otherwise [2.3+](2.3+],\n            "image_width":  (int) // if the file is an image, image width in pixels, null otherwise [    ),\n        },\n        { // folder - similar to file, has also \'path\' and \'children\' but no \'source\' or \'url\'\n            "title": (string), // folder name,\n            "shorttitle": (string), // optional, if you prefer to display a short title\n            "path": (string), // path to this folder. In case of dynload=true (and for non-JS filepicker) the value will be passed to repository_xxx::get_listing() in order to retrieve children\n            "date": (int),\n            "datemodified": (int),\n            "datecreated": (int),\n            "thumbnail": (string),\n            "icon": ,// see above,\n            "children": [\n              // presence of this attribute actually tells file picker that this is a folder. In case of dynload=true, it should be empty array\n              // otherwise it is a nested list of contained files and folders\n            ]\n        }\n    },\n    // The \'object\' tag can be used to embed an external web page or application within the filepicker\n    "object": {\n       "type": (string), // e.g. \'text/html\', \'application/x-shockwave-flash\'\n       "src": (string), // the website address to embed in the object\n    }\n}\n'))),(0,o.kt)("h3",{id:"dynamically-loading"},"Dynamically loading"),(0,o.kt)("p",null,"Some repositories contain many files which cannot load in one time, in this case, we need dynamically loading to fetch them step by step, files in subfolder won't be listed until user click the folder in file picker treeview."),(0,o.kt)("p",null,"As a plug-in developer, if you set dynload flag as ",(0,o.kt)("strong",{parentName:"p"},"true"),", you should return files and folders (set children as a null array) in current path only instead of building the whole file tree."),(0,o.kt)("p",null,"The use of the ",(0,o.kt)("strong",{parentName:"p"},"object")," tag, instead of returning a ",(0,o.kt)("strong",{parentName:"p"},"list")," of files, allows you to embed an external file chooser within the repository panel. See ",(0,o.kt)("a",{parentName:"p",href:"https://docs.moodle.org/dev/Repository_plugins_embedding_external_file_chooser"},"Repository plugins embedding external file chooser")," for details about how to do this."),(0,o.kt)("h3",{id:"user-login-optional"},"User login (optional)"),(0,o.kt)("p",null,"If our plugin allows a user to log in to a remote service, you can support this using the ",(0,o.kt)("inlineCode",{parentName:"p"},"print_login()")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"check_login")," function, which are desribed below."),(0,o.kt)("h4",{id:"print_login"},"print_login"),(0,o.kt)("p",null,"For plugins which need to support login to a remote service, the ",(0,o.kt)("inlineCode",{parentName:"p"},"print_login()")," function can be used to return an array of the form elements needed to support the login."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It is important to note that the repository login can be called on both Ajax and non ajax requests. For this reason the ",(0,o.kt)("inlineCode",{parentName:"p"},"print_login()")," should check for ",(0,o.kt)("inlineCode",{parentName:"p"},"$this->options['ajax']")," to know if it should return an array or the full login HTML form."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function print_login() { // From repository_pluginname\n    global $OUTPUT;\n\n    if ($this->options['ajax']) {\n        $user_field = (object) [\n            'label' => get_string('username', 'repository_pluginname'),\n            'id' => 'pluginname_username',\n            'type' => 'text',\n            'name' => 'al_username',\n        ];\n\n        $passwd_field = (object) [\n            'label' => get_string('password', 'repository_pluginname'),\n            'id' => 'pluginname_password',\n            'type' => 'password',\n            'name' => 'al_password',\n        ];\n\n        $ret = [];\n        $ret['login'] = [$user_field, $passwd_field];\n        return $ret;\n    } else { // Non-AJAX login form - directly output the form elements.\n        // Print the login form HTML including the input username and password fields.\n        $loginform = new repository_pluginname\\output\\login();\n        echo $OUTPUT->render($loginform);\n        // Example of a login form:\n        // <label> Username </label>\n        // <input type=\"text\" name=\"al_username\" />\n        // <label> Password </label>\n        // <input type=\"password\" name=\"al_password\" />\n        // <input type=\"submit\" value=\"Enter\" />\n    }\n}\n")))),(0,o.kt)("p",null,"This will help to generate a form by file picker which contains user name and password input elements."),(0,o.kt)("p",null,"If your login form is static and never changes, you can add ",(0,o.kt)("inlineCode",{parentName:"p"},"$ret['allowcaching']) = true;")," and filepicker will not send the request to the server every time user opens the login/search form."),(0,o.kt)("p",null,"For plugins that do not fully process the login via a popup window, the submitted details can be retrieved, from within the ",(0,o.kt)("inlineCode",{parentName:"p"},"__construct")," function, via ",(0,o.kt)("inlineCode",{parentName:"p"},"$submitted = optional_param('fieldname', [PARAM_INT/PARAM_TEXT)"),"."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="lib/alfresco/lib.php"',title:'"lib/alfresco/lib.php"'},"public function __construct($repositoryid, $context = SYSCONTEXTID, $options = []) {\n    global $SESSION;\n\n    /* Skipping code that is not relevant to user login */\n\n    $this->alfresco = new Alfresco_Repository($this->options['alfresco_url']);\n    $this->username = optional_param('al_username', '', PARAM_RAW);\n    $this->password = optional_param('al_password', '', PARAM_RAW);\n    try{\n        // deal with user logging in.\n        if (empty($SESSION->{$this->sessname}) && !empty($this->username) && !empty($this->password)) {\n            $this->ticket = $this->alfresco->authenticate($this->username, $this->password);\n            $SESSION->{$this->sessname} = $this->ticket;\n        } else {\n            if (!empty($SESSION->{$this->sessname})) {\n                $this->ticket = $SESSION->{$this->sessname};\n            }\n        }\n        $this->user_session = $this->alfresco->createSession($this->ticket);\n        $this->store = new SpacesStore($this->user_session);\n    } catch (Exception $e) {\n        $this->logout();\n    }\n    $this->current_node = null;\n\n    /* Skipping code that is not relevant to user login */\n\n}\n")))),(0,o.kt)("p",null,"Many types include a single element of type 'popup' with the param 'url' pointing at the URL used to authenticate the repo instance."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Code taken from repository_boxnet"',title:'"Code',taken:!0,from:!0,'repository_boxnet"':!0},'public function print_login() {\n    $ticket = $this->boxclient->getTicket();\n    if ($this->options[\'ajax\']) {\n        $loginbtn = (object)[\n            \'type\' => \'popup\',\n            \'url\' => \' https://www.box.com/api/1.0/auth/\' . $ticket->get_oauth_tokens(),\n        ];\n        $result = [];\n        $result[\'login\'] = [$loginbtn];\n        return $result;\n    } else {\n        // Print the login form HTML including the input username, password and ticket fields.\n        $loginform = new repository_boxnet\\output\\login($ticket);\n        echo $OUTPUT->render($loginform);\n        // Example of a login form:\n        // <label> Username </label>\n        // <input type="text" name="boxusername" />\n        // <label> Password </label>\n        // <input type="password" name="boxpassword" />\n        // <input type="hidden" name="ticket" value="{$ticket->get_oauth_tokens()}" />\n        // <input type="submit" value="Enter" />\n    }\n}\n')))),(0,o.kt)("h4",{id:"check_login-bool"},"check_login(): bool"),(0,o.kt)("p",null,"This function will return a boolean value to tell Moodle whether the user has logged in.\nBy default, this function will return true."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function check_login(): bool {\n    global $SESSION;\n    return !empty($SESSION->{$this->sessname});\n}\n")),(0,o.kt)("h4",{id:"logout"},"logout"),(0,o.kt)("p",null,"When a user clicks the logout button in file picker, this function will be called. You may clean up the session or disconnect the connection with remote server here. After this the code should return something suitable to display to the user (usually the results of calling ",(0,o.kt)("strong",{parentName:"p"},"$this->print_login()"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="lib/alfresco/lib.php"',title:'"lib/alfresco/lib.php"'},"public function logout() {\n    global $SESSION;\n    unset($SESSION->{$this->sessname});\n    return $this->print_login();\n}\n")),(0,o.kt)("h3",{id:"transferring-files-to-moodle-optional"},"Transferring files to Moodle (optional)"),(0,o.kt)("p",null,"These functions all relate to transferring the files into Moodle, once they have been chosen in the filepicker. All of them are optional and have default implementations which are often suitable to use as they are."),(0,o.kt)("h4",{id:"get_file_referencesource"},"get_file_reference($source)"),(0,o.kt)("p",null,"This function takes $source as in user input, parses and cleans it (recommended to call clean_param()). It prepares the reference to the file in repository-specific format that would be passed on to methods get_file(), get_link(), get_moodle_file(), get_file_by_reference() and/or stored in DB in case of creating a shortcut to file. For the most of repositories it is just clean $source value. For has_moodle_files-repositories this function also changes encoding."),(0,o.kt)("h4",{id:"get_fileurl-filename--"},'get_file($url, $filename = "")'),(0,o.kt)("p",null,"For FILE_INTERNAL or FILE_REFERENCE this function is called at the point when the user has clicked on the file and then on 'select this file' to add it to the filemanager / editor element. It does the actual transfer of the file from the repository and onto the Moodle server. The default implementation is to download the $url via CURL. The $url parameter is the $reference returned by get_file_reference (above, but usually the same as the 'source' returned by 'get_listing'). The $filename should usually be processed by $path = $this->prepare_file($filename), giving the full 'path' where the file should be saved locally. This function then returns an array, containing:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"path - the local path where the file was saved"),(0,o.kt)("li",{parentName:"ul"},"url - the $url param passed into the function")),(0,o.kt)(s.mQ,{mdxType:"Tabs"},(0,o.kt)(s.E2,{value:"generic",label:"Basic example",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function get_file($url, $filename = '') {\n// Default implementation from the base 'repository' class\n    $path = $this->prepare_file($filename); // Generate a unique temporary filename\n    $curlobject = new curl();\n    $result = $curlobject->download_one($url, null, ['filepath' => $path, 'timeout' => self::GETFILE_TIMEOUT]);\n    if ($result !== true) {\n        throw new moodle_exception('errorwhiledownload', 'repository', '', $result);\n    }\n    return ['path'=>$path, 'url'=>$url];\n}\n"))),(0,o.kt)(s.E2,{value:"aquella",label:"repository_aquella example",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Slightly extended version taken from repository_equella"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function get_file($reference, $filename = '') {\n    global $USER;\n    // Replace the line below by any method your plugin have to check a reference.\n    $details = example_external_server::get_details_by_reference($reference->reference));\n    if (!isset($details->url) || !($url = $this->appendtoken($details->url))) {\n        // Occurs when the user isn't known..\n        return null;\n    }\n    $path = $this->prepare_file($filename);\n    $cookiepathname = $this->prepare_file($USER->id. '_'. uniqid('', true). '.cookie');\n    $curlobject = new curl(['cookie'=>$cookiepathname]);\n    $result = $curlobject->download_one(\n        $url,\n        null,\n        ['filepath' => $path, 'followlocation' => true, 'timeout' => self::GETFILE_TIMEOUT]\n    );\n    // Delete cookie jar.\n    if (file_exists($cookiepathname)) {\n        unlink($cookiepathname);\n    }\n    if ($result !== true) {\n        throw new moodle_exception('errorwhiledownload', 'repository', '', $result);\n    }\n    return ['path'=>$path, 'url'=>$url];\n}\n")))),(0,o.kt)("h4",{id:"get_linkurl"},"get_link($url)"),(0,o.kt)("p",null,"Used with ",(0,o.kt)("inlineCode",{parentName:"p"},"FILE_EXTERNAL")," to convert a reference (from 'get_file_reference', but ultimately from the output of 'get_listing') into a URL that can be used directly by the end-user's browser. Usually just returns the original $url, but may need further transformation based on the internal implementation of the repository plugin."),(0,o.kt)("h4",{id:"get_file_source_infosource"},"get_file_source_info($source)"),(0,o.kt)("p",null,"Takes the 'source' field from 'get_listing' (as returned by the user's browser) and returns the value to be stored in files.source field in DB (regardless whether file is picked as a copy or by reference). It indicates where the file came from. It is advised to include either full URL here or indication of the repository.\nExamples: 'Dropbox: /filename.jpg', '",(0,o.kt)("a",{parentName:"p",href:"http://fullurl.com/path/file'"},"http://fullurl.com/path/file'"),", etc."),(0,o.kt)("p",null,"This value will be used to display warning message if reference can not be restored from backup.  Also it can (although not has to) be used in get_reference_details() to produce the human-readable reference source in the fileinfo dialogue in the file manager."),(0,o.kt)("h3",{id:"search-functions-optional"},"Search functions (optional)"),(0,o.kt)("p",null,"These functions allow you to implement search functionality within your repository."),(0,o.kt)("h4",{id:"print_search"},"print_search"),(0,o.kt)("p",null,"When a user clicks the search button on file picker, this function will be called to return a search form. By default, it will create a form with single search bar - you can override it to create a advanced search form."),(0,o.kt)("p",null,"A custom search form must include the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A text field element named ",(0,o.kt)("strong",{parentName:"li"},"s"),", this is where users will type in their search criteria"),(0,o.kt)("li",{parentName:"ul"},"A hidden element named ",(0,o.kt)("strong",{parentName:"li"},"repo_id")," and the value must be the id of the repository instance"),(0,o.kt)("li",{parentName:"ul"},"A hidden element named ",(0,o.kt)("strong",{parentName:"li"},"ctx_id")," and the value must be the context id of the repository instance"),(0,o.kt)("li",{parentName:"ul"},"A hidden element named ",(0,o.kt)("strong",{parentName:"li"},"sesskey")," and the value must be the session key")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php true",metastring:"title=\"The default implementation in class 'repository'\"",title:'"The',default:!0,implementation:!0,in:!0,"'repository'\"":!0},"public function print_search() {\n    global $PAGE;\n    $renderer = $PAGE->get_renderer('core', 'files');\n    return $renderer->repository_default_searchform();\n    // The default search HTML from repository/renderer.php:\n    // <div class=\"fp-def-search\"><input name=\"s\" value='.get_string('search', 'repository').' /></div>;\n}\n")))),(0,o.kt)("h4",{id:"searchsearch_text-page--0"},"search($search_text, $page = 0)"),(0,o.kt)("p",null,"Return the results of doing the search. Any additional parameters from the search form can be retrieved by $param = optional_param('paramname', [PARAM_INT / PARAM_TEXT);."),(0,o.kt)("p",null,"The return should return an array containing:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"list - with the same layout as the 'list' element in 'get_listing'")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Example from repoistory_googledocs"',title:'"Example',from:!0,'repoistory_googledocs"':!0},"public function search($search_text, $page = 0) {\n    $gdocs = new google_docs($this->googleoauth);\n    return [\n        'dynload' => true,\n        'list' => $gdocs->get_file_list($search_text),\n    ];\n}\n")))),(0,o.kt)("h4",{id:"global_search"},"global_search()"),(0,o.kt)("p",null,"Return true if should be included in a search throughout all repositories (currently not available via the UI)"),(0,o.kt)("h3",{id:"repository-support-for-returning-file-as-aliasshortcut"},"Repository support for returning file as alias/shortcut"),(0,o.kt)("p",null,'It is possible to link to the file from external (or internal) repository by reference. In UI it is called "create alias/shortcut". This creates a row in {files} table but the contents of the file is not stored. Although it may be cached by repository if developer wants to.'),(0,o.kt)("p",null,"Make sure that function supported_returntypes() returns FILE_REFERENCE among other types."),(0,o.kt)("p",null,"Note that external file is synchronised by moodle when UI wants to show the file size."),(0,o.kt)("h4",{id:"get_reference_file_lifetime"},"get_reference_file_lifetime()"),(0,o.kt)("p",null,"Return minimum number of seconds before checking for changes to the file (default implementation = 1 day)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function get_reference_file_lifetime($ref) {\n    return DAYSECS; // One day, 60 * 60 * 24 seconds.\n}\n")),(0,o.kt)("h4",{id:"sync_individual_filestored_file-storedfile"},"sync_individual_file(stored_file $storedfile)"),(0,o.kt)("p",null,"Called after the file has reached the 'lifetime' specified above to see if it should now be synchronised (default implementation is to return true)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"public function sync_individual_file(stored_file $storedfile) {\n    return true;\n}\n")),(0,o.kt)("h4",{id:"get_reference_detailsreference-filestatus--0"},"get_reference_details($reference, $filestatus = 0)"),(0,o.kt)("p",null,"Returns human-readable information about where the original file is stored (to be displayed in the filepicker properties box). It is usually prefixed with repository name and semicolon (for example 'Myrepository: ",(0,o.kt)("a",{parentName:"p",href:"http://url.to.file'"},"http://url.to.file'"),"). ",(0,o.kt)("inlineCode",{parentName:"p"},"$reference")," is the 'source' output by ",(0,o.kt)("inlineCode",{parentName:"p"},"get_listing"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"$filestatus")," can be either 0 (OK - default) or 666 (source file missing)."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="lib.php"',title:'"lib.php"'},"public function get_reference_details($reference, $filestatus = 0) {\n    if (!$filestatus) {\n        // Replace the line below by any method your plugin have to check a reference.\n        $details = example_external_server::get_details_by_reference($reference);\n        return $this->get_name() . ': ' . $details->filename;\n    } else {\n        return get_string('lostsource', 'repository', '');\n    }\n}\n")))),(0,o.kt)("h4",{id:"get_file_by_referencereference"},"get_file_by_reference($reference)"),(0,o.kt)("p",null,"Returns up-to-date information about the original file, only called when the 'lifetime' is reached and 'sync_individual_file' returns true."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"For image files - download the file and return either $ret->filepath (full path on the server), $ret->handle (open handle to the file) or $ret->content (raw data from the file) to allow the file to be saved into the Moodle filesystem and the thumbnail to be updated"),(0,o.kt)("li",{parentName:"ul"},"For non-image files - avoid downloading the file (if possible) and just return $ret->filesize to update that information"),(0,o.kt)("li",{parentName:"ul"},"For missing / inaccessible files - return null\nRemember this function may be called quite a lot, as the filemanager often wants to know the filesize.")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="/lib.php"',title:'"/lib.php"'},"public function get_file_by_reference($reference) {\n    global $USER;\n    // Replace the line below by any method your plugin have to check a reference.\n    $details = example_external_server::get_details_by_reference($reference->reference));\n    if (!isset($details->url) || !($url = $this->appendtoken($details->url))) {\n        // Occurs when the user isn't known.\n        return null;\n    }\n\n    // Download the file details.\n    $return = null;\n    $cookiepathname = $this->prepare_file($USER->id . '_' . uniqid('', true) . '.cookie');\n    $headparams = ['followlocation' => true, 'timeout' => self::SYNCFILE_TIMEOUT];\n    $curlobject = new curl(['cookie' => $cookiepathname]);\n\n    if (file_extension_in_typegroup($ref->filename, 'web_image')) {\n        // The file is an image - download and return the file path.\n        $path = $this->prepare_file('');\n        $result = $curlobject->download_one($url, null, $headparams);\n        if ($result === true) {\n            $return = (object) ['filepath' => $path];\n        }\n    } else {\n        // The file is not an image - just get the file details.\n\n        $result = $curlobject->head($url, $headparams);\n    }\n\n    // Delete cookie jar.\n    if (file_exists($cookiepathname)) {\n        unlink($cookiepathname);\n    }\n\n    $this->connection_result($ccurlobject->get_errno());\n    $curlinfo = $ccurlobject->get_info();\n    if ($return === null && isset($curlinfo['http_code']('list'])) &&\n            $curlinfo['http_code']== 200 &&\n            array_key_exists('download_content_length', $curlinfo) &&\n            $curlinfo['download_content_length']('http_code']) >= 0) {\n        // We received a correct header and at least can tell the file size.\n        $return = (object) ['filesize' => $curlinfo['download_content_length']];\n    }\n    return $return;\n}\n")))),(0,o.kt)("h4",{id:"send_filestoredfile-lifetime86400-filter0-forcedownloadfalse-array-options--null"},"send_file($storedfile, $lifetime=86400, $filter=0, $forcedownload=false, array $options = null)"),(0,o.kt)("p",null,"Send the requested file back to the user's browser. The 'reference' for the file can be found via $storedfile->get_reference(). If the file is not found / no longer exists, the function 'send_file_not_found()' should be used. Otherwise the file should be output directly, via the most appropriate method:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Use a 'Location: ' header to redirect to the external URL"),(0,o.kt)("li",{parentName:"ul"},"Download the file and cache within the Moodle filesystem (possibly using '$this->import_external_file_contents()'), then call 'send_stored_file'.")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It is up to the repository developer to decide whether to actually download the file or to return a locally cached copy instead."))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"View example"),(0,o.kt)("div",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="/lib.php"',title:'"/lib.php"'},"public function send_file($stored_file, $lifetime=86400 , $filter=0, $forcedownload=false, array $options = null) {\n    // Replace the line below by any method your plugin have to check a reference.\n    $details  = example_external_server::get_details_by_reference($stored_file->get_reference()));\n    $url = $this->appendtoken($details->url);\n    if ($url) {\n        header('Location: ' . $url);\n    } else {\n        send_file_not_found();\n    }\n}\n")))),(0,o.kt)("p",null,"An example of caching files within the Moodle filesystem can be found in repository_dropbox."))}v.isMDXComponent=!0},2861:function(e,t){"use strict";t.Z="data:image/png;base64,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"}}]);