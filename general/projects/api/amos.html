<!doctype html>
<html lang="en-AU" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-general docs-doc-id-projects/api/amos">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L9EE8RW5B1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L9EE8RW5B1",{})</script>





<link rel="icon" href="/devdocs/img/icons/orange_m.svg">
<link rel="manifest" href="/devdocs/manifest.json">
<meta name="theme-color" content="rgb(208, 99, 0)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/devdocs/img/icons/maskable_icon.png">
<link rel="mask-icon" href="/devdocs/img/icons/maskable_icon.png" color="rgb(208, 99, 0)">
<meta name="msapplication-TileImage" content="/devdocs/img/icons/maskable_icon.png">
<meta name="msapplication-TileColor" content="#000"><title data-rh="true">Automated Manipulation of Strings (AMOS) | Moodle Developer Resources</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://moodledev.io/devdocs/general/projects/api/amos"><meta data-rh="true" name="docusaurus_locale" content="en-AU"><meta data-rh="true" name="docsearch:language" content="en-AU"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-general-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-general-current"><meta data-rh="true" property="og:title" content="Automated Manipulation of Strings (AMOS) | Moodle Developer Resources"><meta data-rh="true" name="description" content="&lt;ProjectSummary"><meta data-rh="true" property="og:description" content="&lt;ProjectSummary"><link data-rh="true" rel="icon" href="/devdocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://moodledev.io/devdocs/general/projects/api/amos"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/general/projects/api/amos" hreflang="en-AU"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/general/projects/api/amos" hreflang="x-default"><link rel="stylesheet" href="/devdocs/assets/css/styles.39c19b8d.css">
<link rel="preload" href="/devdocs/assets/js/runtime~main.f6d4a224.js" as="script">
<link rel="preload" href="/devdocs/assets/js/main.5302e573.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/devdocs/"><div class="navbar__logo"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--light_HNdA" height="35px" width="138px"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--dark_i4oU" height="35px" width="138px"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/devdocs/docs/apis">Guides</a><a class="navbar__item navbar__link" href="/devdocs/general/community/contribute">Community</a><a class="navbar__item navbar__link" href="/devdocs/general/development/gettingstarted">Coding</a><a class="navbar__item navbar__link" href="/devdocs/general/development/process">Process</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/devdocs/docs">master</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/devdocs/docs">master</a></li><li><a class="dropdown__link" href="/devdocs/docs/4.0">4.0</a></li><li><a href="https://docs.moodle.org/dev/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Legacy documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/devdocs/versions">All versions</a></li></ul></div><a href="https://github.com/moodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="wrapper_Jz6K"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current,docs-general-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/devdocs/general/projects">Projects</a><button aria-label="Toggle the collapsible sidebar category &#x27;Projects&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/devdocs/general/projects/docs/migration">Active</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/projects/docs/migration">Dev Docs Migration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/devdocs/general/projects/api/string-deprecation">Complete</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/projects/api/string-deprecation">String deprecation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/devdocs/general/projects/api/amos">AMOS</a></li></ul></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/devdocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/devdocs/general/projects"><span itemprop="name">Projects</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Complete</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AMOS</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automated Manipulation of Strings (AMOS)</h1></header><table class="projecttable_Zy3x"><tbody><tr><th>Owners</th><td><style data-emotion="css 1ontqvh">.css-1ontqvh{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;}</style><ul class="MuiList-root MuiList-padding css-1ontqvh"><div><style data-emotion="css 14owld3">.css-14owld3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;}.css-14owld3.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.12);}.css-14owld3.Mui-selected{background-color:rgba(25, 118, 210, 0.08);}.css-14owld3.Mui-selected.Mui-focusVisible{background-color:rgba(25, 118, 210, 0.2);}.css-14owld3.Mui-disabled{opacity:0.38;}</style><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding MuiListItem-alignItemsFlexStart css-14owld3"><style data-emotion="css s1bfy">.css-s1bfy{min-width:56px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-top:8px;}</style><div class="MuiListItemAvatar-root MuiListItemAvatar-alignItemsFlexStart css-s1bfy"><style data-emotion="css 3i9vrz">.css-3i9vrz{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><div class="MuiAvatar-root MuiAvatar-circular css-3i9vrz"><style data-emotion="css 1hy9t21">.css-1hy9t21{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}</style><img src="https://avatars.githubusercontent.com/mudrd8mz" class="MuiAvatar-img css-1hy9t21"></div></div><a href="https://github.com/mudrd8mz" target="_blank" rel="noopener noreferrer"><style data-emotion="css 1xar93x">.css-1xar93x{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0;margin-top:6px;margin-bottom:6px;}</style><div class="MuiListItemText-root MuiListItemText-multiline css-1xar93x"><style data-emotion="css yb0lig">.css-yb0lig{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;display:block;}</style><span class="MuiTypography-root MuiTypography-body1 MuiListItemText-primary css-yb0lig">David Mudrak</span><style data-emotion="css mbfek">.css-mbfek{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;color:rgba(0, 0, 0, 0.6);display:block;}</style><p class="MuiTypography-root MuiTypography-body2 MuiListItemText-secondary css-mbfek">mudrd8mz</p></div></a></li></div></ul></td></tr><tr><th>Status</th><td>Complete</td></tr><tr><th>Links</th><td><div><a href="http://moodle.org/mod/forum/discuss.php?d=118707#p542197" target="_blank" rel="noopener noreferrer">Discussion</a></div></td></tr><tr><th>Issues</th><td><div><a href="https://tracker.moodle.org/browse/MDL-18797" target="_blank" rel="noopener noreferrer">MDL-18797</a></div></td></tr></tbody></table><p><strong>AMOS</strong> stands for Automated Manipulation of Strings. AMOS is a central repository of Moodle strings and their history. It tracks the addition of English strings into Moodle code, gathers translations, handles common translation tasks and generates language packages to be deployed on Moodle servers.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The name was chosen in honour of <a href="http://en.wikipedia.org/wiki/John_Amos_Comenius" target="_blank" rel="noopener noreferrer">John Amos Comenius</a>, the author of <code>Janua linguarum reserata</code> (Gate to Languages Unlocked), who may be considered the father of modern education.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="amos-design">AMOS design<a class="hash-link" href="#amos-design" title="Direct link to heading">​</a></h2><p>This part of the document was the original specification used for development.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overall-picture">Overall picture<a class="hash-link" href="#overall-picture" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="AMOS workflow" src="/devdocs/assets/images/lang20amosflow-9240549857943e11e784322c3d77e170.png" width="992" height="278" class="img_ev3q"></p><ol><li>Developers add a new string by adding them into appropriate English $strings array definition file (for example, <code>/mod/workshop/lang/en/workshop.php</code>). This file is committed into Moodle main CVS repository as a part of the code.</li><li>CVS repository is mirrored automatically on the fly in a git repository. This git repository is used for further processing because parsing the strings file and tracking their history is much simpler in this system. The whole history is present in the git clone so there is no need to ask CVS server for anything once it is fetched.</li><li>The Git repository is regularly checked for any changes in string definition files. If any modification is detected then the file is parsed and any addition, modification, or removal of a string is recorded in an English strings database, together with a meta-information about the author of the change, timestamp, branch, commit identification (git commit hash) and so on.</li><li>So called translation stage (or cache) is used during the translation. This is similar to the session cache when working with <a href="https://docs.moodle.org/dev/XMLDB" target="_blank" rel="noopener noreferrer">XMLDB</a>. Once the translator is happy with the work, they submit the translation into the database of the translated strings.</li><li>The non-English strings database contains the history of the translation of all Moodle strings in all supported languages. This database is used as a source to generate the up-to-date language package in various formats (ZIP to be deployed at the servers, XML to be used by an external translation tools, etc).</li><li>Moodle site administrators update their installed language packs by downloading the ZIP files generated from the database (or, in the future, they can fetch the pack in other format)</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amos-processes">AMOS processes<a class="hash-link" href="#amos-processes" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="AMOS workflow" src="/devdocs/assets/images/lang20amosflow2-391fd99d50c5ca4cf2840522c8fa9001.png" width="798" height="279" class="img_ev3q"></p><ul><li><strong>Tracking CVS commits</strong>. Run as a cron job. Looks for new/modified/removed strings in Moodle source code (core and contrib) and registers these changes in the AMOS database.</li><li><strong>Uploading strings</strong>. Both English and translated strings may be registered from uploaded files. This way, 3rd modules not tracked by AMOS automatically (because they are not in our contrib) can be processed in AMOS.</li><li><strong>Translating strings via web</strong>. AMOS provides an interface for translating stored strings (<a href="https://tracker.moodle.org/browse/MDL-21691" target="_blank" rel="noopener noreferrer">MDL-21691</a>).</li><li><strong>Staging</strong>. Strings from various sources end in a <a href="http://en.wikipedia.org/wiki/Staging_(data)" target="_blank" rel="noopener noreferrer">staging area</a>. They are stored here temporarily before they are committed into the main strings table.</li><li><strong>Committing</strong>. A set of strings in the stage is committed into the main strings table.</li></ul><p>Thanks to this design, we have a single interface to get data from stage into the main strings repository. For every supported format/way to get strings, just a class implementing &#x27;stageable&#x27; interface is needed to convert the input format into the staging area.</p><p>Hierarchy of classes is expected to be available for input processing. For example, the process that tracks commits history in CVS prepares a PHP file with the checkout. So we have a class that is able to convert <code>array $string[]()</code> defined in PHP file into staging area. Once we have such class, it can be used to process PHP files uploaded by developers/translators, too.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-plan">Implementation plan<a class="hash-link" href="#implementation-plan" title="Direct link to heading">​</a></h3><p>The implementation proposal evolved from the idea by Petr Skoda <a href="http://moodle.org/mod/forum/discuss.php?d=118707#p542197" target="_blank" rel="noopener noreferrer">discussed at moodle.org</a>. The key point is that translators do not have direct access to the source code repository (CVS) any more. There is a central tool (known as AMOS nowadays) that looks after proper branching and keeping history of the language packs. The current proposal follows.</p><ol><li>There is a separate Moodle site at <a href="http://lang.moodle.org" target="_blank" rel="noopener noreferrer">http://lang.moodle.org</a> MNet&#x27;ed with <a href="http://moodle.org." target="_blank" rel="noopener noreferrer">http://moodle.org.</a> This site is intended for our developers, translators and other community members interested in the translation process. Current Languages forum at Using Moodle can be eventually moved into this new languages portal.</li><li>AMOS is implemented as a local plugin <code>/local/amos</code> installed at <a href="http://lang.moodle.org." target="_blank" rel="noopener noreferrer">http://lang.moodle.org.</a> Because this is the only Moodle site with this plugin, using /local plugin mechanism is a natural way to implement, develop and maintain it.</li><li>There is a course &quot;Moodle Translation&quot; in this portal containing (among other useful things) a clear link to the <code>/local/amos/view.php</code> page.</li><li>During Moodle 2.0 beta period, translator used AMOS portal to prepare the translations of the new Moodle release.</li><li>AMOS installation at <a href="http://lang.moodle.org" target="_blank" rel="noopener noreferrer">http://lang.moodle.org</a> uses its own git clone of our official git mirror to have access to the English strings. Keeping the git mirror up-to-date and synced is a prerequisition for the proper AMOS functionality.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use cases<a class="hash-link" href="#use-cases" title="Direct link to heading">​</a></h3><ol><li><strong>Developers</strong> write the code and commits it into CVS. They can create or modify English strings as needed in the current way of direct modification of the strings definition file.</li><li><strong>Translators</strong> come to <a href="http://lang.moodle.org" target="_blank" rel="noopener noreferrer">http://lang.moodle.org</a> to translate Moodle. No other way is possible yet.<ol><li>Translators can choose the Moodle version (1.8, 1.9 or 2.0) to translate</li><li>Translators can display the list of missing strings to translate</li><li>Translators can display the list of English strings that were modified since their last translation so they should be re-checked</li><li>Translators can display the history of string wording, authors of the change, commit messages explaining the change</li><li>Other useful tools and filters are available, like displaying all strings containing a given phrase etc. See <a href="https://tracker.moodle.org/browse/MDL-18797" target="_blank" rel="noopener noreferrer">MDL-18797</a> for details</li><li>After providing new or modified translations, translators &quot;commit&quot; their changes through the web interface, providing a commit message</li></ol></li><li><strong>Administrators</strong> can download language packages as ZIP files from <a href="http://download.moodle.org" target="_blank" rel="noopener noreferrer">http://download.moodle.org</a> or let them update automatically from the Moodle<ol><li>Packages are regenerated automatically as they are at the moment, with the only difference that the database and not CVS is used as their source</li></ol></li><li><strong>Contributors</strong> <!-- -->[must think about this yet]<!-- --> - their plugins in <code>CONTRIB</code> can be mirrored into git (one day this will happen anyway ;-)) and then AMOS can process them easily. Or we could add a feature that the contributor can upload the file with English strings definition manually and &quot;register&quot; the strings this way.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-structure">Database structure<a class="hash-link" href="#database-structure" title="Direct link to heading">​</a></h2><p>The core of the whole AMOS system is a single table containing the history of all changes of all strings from all components in all languages. This one is called amos_repository. All other operations, like committing a translation, getting the current snapshot etc., are based on this table. After an initial import of CVS history, the table contains around 3.6 millions of records.</p><p>There is yet another table where the permissions to translate a language are stored, which is not so important and is trivial (therefore not documented here).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amos_repository">amos_repository<a class="hash-link" href="#amos_repository" title="Direct link to heading">​</a></h3><p>Contains all Moodle strings and their history</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>int (10) unsigned not null seq</td><td></td></tr><tr><td>branch</td><td>int (10) unsigned not null</td><td>The code of the branch this string is valid for</td></tr><tr><td>lang</td><td>char (20) not null</td><td>The code of the language this string belongs to. Like en, cs or es</td></tr><tr><td>component</td><td>char (255) not null</td><td>The name of the component this string belongs to. Like <code>moodle</code> or <code>workshopform_accumulative</code></td></tr><tr><td>stringid</td><td>char (255) not null</td><td>The code of the string</td></tr><tr><td>text</td><td>text (big) not null</td><td>The localized string text</td></tr><tr><td>timemodified</td><td>int (10) unsigned not null</td><td>The timestamp of the commit</td></tr><tr><td>commitmsg</td><td>text (big)</td><td>Commit message</td></tr><tr><td>commithash</td><td>char (40)</td><td>The git commit hash that introduced this string</td></tr><tr><td>source</td><td>char (255)</td><td>The source of this string - git, email etc.</td></tr><tr><td>deleted</td><td>int (2) unsigned default 0</td><td>Is the string deleted? If not, it will be generated into the lang packs</td></tr><tr><td>userid</td><td>int (10) unsigned</td><td>If the author is known in the local user table, store their id here</td></tr><tr><td>userinfo</td><td>char (255)</td><td>Helps to identify the author of the change, for example a name from CVS commit</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="keys">Keys<a class="hash-link" href="#keys" title="Direct link to heading">​</a></h4><table><thead><tr><th>Name</th><th>Type</th><th>Field(s)</th><th>Reference</th></tr></thead><tbody><tr><td>primary</td><td>primary</td><td>id</td><td></td></tr><tr><td>fk_user</td><td>foreign</td><td>userid</td><td>user (id)</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="indexes">Indexes<a class="hash-link" href="#indexes" title="Direct link to heading">​</a></h4><table><thead><tr><th>Name</th><th>Type</th><th>Field(s)</th><th>Description</th></tr></thead><tbody><tr><td>ix_snapshot</td><td>Not unique</td><td>component, lang, branch</td><td>Optimised for getting a snapshot of all current strings in one component</td></tr><tr><td>ix_lang</td><td>Not unique</td><td>lang</td><td>For getting a list of all known components. In some cases, we need to filter English records only</td></tr><tr><td>ix_timemodified</td><td>Not unique</td><td>timemodified</td><td>This index allows to search for the recent records in the log output</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="features">Features<a class="hash-link" href="#features" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracking-the-changes-in-the-english-strings">Tracking the changes in the English strings<a class="hash-link" href="#tracking-the-changes-in-the-english-strings" title="Direct link to heading">​</a></h3><p><strong>Implemented in</strong>: <code>/local/amos/cli/parse-core.php</code></p><p>AMOS uses its own git clone of Moodle repository. It runs <code>git whatchanged</code> to see what files were affected by every single commit ever. Once it detects a change in a valid English string file, it checks out that revision of the file and compares its content with the current snapshot of the strings database. New record is added into the strings table for every new, modified or removed string in the checked out file. The commit hash of the last fully processed commit is stored in <code>$CFG-&gt;dataroot/amos/var/MOODLE_xx.startat</code> so that next time AMOS analyzes just new commits.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amos-script">AMOS script<a class="hash-link" href="#amos-script" title="Direct link to heading">​</a></h3><p>AMOS script allows us to propagate changes in the English language pack into other languages.</p><p>Sometimes we want to reorganize the English language pack - for example split a component into subcomponents (as happened with auth.php), rename string identifiers, fork a string according the meaning (for example, <code>fullname</code> may be different when talking about a human and about a course) etc. Such a change can be easily done in English by direct editing and committing the <code>lang/en/*.php</code> files. But the translation would get lost and our poor translators would have to translate such strings again.</p><p>There is a way to instruct AMOS to propagate a change in the English lang pack into all other languages at the given branch. We call that AMOS script (or <code>amosbler</code> for the syntax similarity with the assembly language - assembler). Such a script can be uploaded or pasted into a page at AMOS portal and it will just follow the instructions provided. Or - which is more interesting - such a script can be put directly into the commit message of the commit that does the change in the English language pack. In that case, AMOS will automatically run the script right after it process the commit.</p><p>Here is an example of a script that instruct AMOS to process a set of bulk operations over language packages:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AMOS BEGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MOV [description,mod_workshop],[intro,mod_workshop]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CPY [submission,mod_assignment],[submission,mod_workshop]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> HLP forum/forumtype.html,[forumtype_hlp,mod_forum]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMOS END</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, there are three instuctions to be done. The line with <code>MOV</code> (&#x27;move&#x27;) command instructs AMOS to rename the string &#x27;description&#x27; defined in workshop to the new identifier &#x27;intro&#x27;. The second command <code>CPY</code> (&#x27;copy&#x27;) orders to create new string in the workshop module with the identifier &#x27;submission&#x27; and the value of that string shall be taken from the <code>$string[&#x27;submission&#x27;]</code> in the module assignment. If such string already exists in any language, <code>CPY</code> will not replace it. The third command is used for migrating legacy HTML help files into ordinary strings. It tells AMOS to add <code>new $string[&#x27;forumtype_hlp&#x27;]</code> in every language, using the content of the help file <code>forum/forumtype.html</code> as the initial value.</p><p>The script syntax is defined as follows. Note that amosbler keywords are case sensitive so must be upper-case. In pseudo-regexp, the valid AMOS script is defined as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">^[:blank:]*AMOS BEGIN[:blank:]*$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^[:blank:]*[A-Z]{3}[:blank:]+(param1),[:blank:]*(param2), ...,[:blank:]*(paramn)[:blank:]$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^[:blank:]*AMOS END[:blank:]*$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In human language, this roughly means: the script is a block of lines starting with <code>AMOS BEGIN</code> or <code>AMOS START</code> and ending with <code>AMOS END</code> lines. Every instruction is on its own line. Instruction has its name (three capital letters like <code>MOV</code>, <code>CPY</code>, <code>HLP</code>, <code>RPL</code>, <code>SMS</code> or <code>GRR</code>) followed by comma-separated parameters.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Beware</h5></div><div class="admonition-content"><p>Every string is referenced as <code>[stringid,component]</code> <strong>but the component is different from what we use in get_string()</strong>. All components use fully normalized <code>plugintype_pluginname</code> syntax (see <code>normalize_component()</code> function in <code>moodlelib</code>). If <code>plugintype === core</code> and <code>pluginname is empty (component &#x27;core&#x27;)</code>, the strings are stored in <code>moodle.php</code>.</p></div></div><table><thead><tr><th>String identification in get_string()</th><th>String identification in AMOS</th></tr></thead><tbody><tr><td>get_string(&#x27;edit&#x27;, &#x27;moodle&#x27;)</td><td>[edit,core]</td></tr><tr><td>get_string(&#x27;submit&#x27;, &#x27;assignment&#x27;)</td><td>[submit,mod_assignment]</td></tr><tr><td>get_string(&#x27;grade_help&#x27;, &#x27;grades&#x27;)</td><td>[grade_help,core_grades]</td></tr><tr><td>get_string(&#x27;send&#x27;, &#x27;message&#x27;)</td><td>[send,core_message]</td></tr><tr><td>get_string(&#x27;hello&#x27;, &#x27;block_greetings&#x27;)</td><td>[hello,block_greetings]</td></tr></tbody></table><p>Currently planned/implemented AMOS script instructions are:</p><ul><li><strong>MOV <!-- -->[source]<!-- -->,<!-- -->[target]</strong>. Move the string. If the source <code>stringid</code> is already defined in the target component, it is not replaced.</li><li><strong>CPY <!-- -->[source]<!-- -->,<!-- -->[target]</strong>. Copy the string. Works as <code>MOV</code> but the source string is not touched.</li><li><strong>HLP component/helpfile.html,<!-- -->[string]</strong>. Convert legacy HTML help file to the string</li><li><strong>REM text</strong>. Allows to put a remark (comment), for example to describe a required operation that can&#x27;t be achieved by current instruction set.</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Ideas for other future instructions: <code>RPL</code> for replace (forced MOV), <code>SMS</code> for sending a message, <code>GRR</code> for something unknown yet but such instruction just must be there ;-)</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>There are no instructions <code>DEL</code> or <code>ADD</code>. AMOS automatically recognized new strings as well as their removal from the commit diffs.</p></div></div><p><strong>Summary of using AMOS script in commit messages:</strong></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Strings can be removed on the master branch easily by removing them from the strings file. No AMOS command is needed. Just make sure the string is not use elsewhere and do not remove the string from stable branches.</p></div></div><ol><li>The commit must modify some string file, AMOS would ignore the commit completely otherwise</li><li>The script must be properly formatted as block of lines</li><li>The strings must be identified in normalized syntax - the main difference is using core for <code>moodle.php</code> and <code>core_*</code> prefix for components in <code>lang/en/*.php</code></li><li>Note that it may take up to an hour that your commit is mirrored into git and then processed by AMOS</li></ol><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>More information about commit message format: <a href="https://docs.moodle.org/dev/Commit_cheat_sheet#Include_AMOS_script_in_the_commit_if_needed" target="_blank" rel="noopener noreferrer">https://docs.moodle.org/dev/Commit_cheat_sheet#Include_AMOS_script_in_the_commit_if_needed</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-installer-files">Generating installer files<a class="hash-link" href="#generating-installer-files" title="Direct link to heading">​</a></h3><p>Implemented, not automated yet</p><p>See <code>cli/export-installer.php</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-settings">Deployment settings<a class="hash-link" href="#deployment-settings" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># crontab -l</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0,30</span><span class="token plain"> 01-23 * * * /usr/local/bin/amos-update </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/amos-update.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     * * * /usr/bin/php /var/www/htdocs/moodle-amos/local/amos/cli/rev-clean.php --full </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/amos-full-rev-clean.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /usr/local/bin/amos-update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Updates AMOS working repositories and registers changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># To be run regularly after git sync</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">AMOSCLIDIR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/www/htdocs/moodle-amos/local/amos/cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">AMOSREPOCORE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/www/data/moodle-amos/amos/repos/moodle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">AMOSREPOLANG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/www/data/moodle-amos/amos/repos/moodle-lang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PHP</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/bin/php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$AMOSREPOCORE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> /usr/local/bin/git pull --quiet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$AMOSREPOLANG</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> /usr/local/bin/git pull --quiet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$PHP</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$AMOSCLIDIR</span><span class="token plain">/parse-core.php </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$PHP</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$AMOSCLIDIR</span><span class="token plain">/parse-lang.php </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$PHP</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$AMOSCLIDIR</span><span class="token plain">/rev-clean.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/devdocs/general/tags/language">Language</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/moodle/devdocs/edit/main/general/projects/api/amos.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-06-08T05:30:45.000Z">08/06/2022</time></b> by <b>Andrew Lyons</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/devdocs/general/projects/api/string-deprecation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">String deprecation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#amos-design" class="table-of-contents__link toc-highlight">AMOS design</a><ul><li><a href="#overall-picture" class="table-of-contents__link toc-highlight">Overall picture</a></li><li><a href="#amos-processes" class="table-of-contents__link toc-highlight">AMOS processes</a></li><li><a href="#implementation-plan" class="table-of-contents__link toc-highlight">Implementation plan</a></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use cases</a></li></ul></li><li><a href="#database-structure" class="table-of-contents__link toc-highlight">Database structure</a><ul><li><a href="#amos_repository" class="table-of-contents__link toc-highlight">amos_repository</a></li></ul></li><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a><ul><li><a href="#tracking-the-changes-in-the-english-strings" class="table-of-contents__link toc-highlight">Tracking the changes in the English strings</a></li><li><a href="#amos-script" class="table-of-contents__link toc-highlight">AMOS script</a></li><li><a href="#generating-installer-files" class="table-of-contents__link toc-highlight">Generating installer files</a></li></ul></li><li><a href="#deployment-settings" class="table-of-contents__link toc-highlight">Deployment settings</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Moodle</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/releases">Release notes</a></li><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/projects">Projects</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation">Developer docs</a></li><li class="footer__item"><a href="https://docs.moodle.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">User docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.moodle.org/dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legacy docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation/code-of-conduct">Code of conduct</a></li><li class="footer__item"><a href="https://moodle.org/mod/forum/view.php?id=55" target="_blank" rel="noopener noreferrer" class="footer__link-item">General Developer Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                    <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                        <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                    </a>
                    </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
Copyright © 2022 Moodle Pty Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/devdocs/assets/js/runtime~main.f6d4a224.js"></script>
<script src="/devdocs/assets/js/main.5302e573.js"></script>
</body>
</html>