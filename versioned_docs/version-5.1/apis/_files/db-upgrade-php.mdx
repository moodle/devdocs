<!-- markdownlint-disable first-line-heading -->
The `db/upgrade.php` file contains upgrade steps, including database schema changes, changes to settings, and other steps which must be performed during upgrade.

See the [Upgrade API](../../guides/upgrade/index.md) documentation for further information.

:::danger Generating Database Schema changes

When making changes to the database schema you **must** use the build-in [XMLDB editor](https://docs.moodle.org/dev/XMLDB_Documentation) within
Moodle. This can be used to generate php upgrade steps.

The [install.xml](../commonfiles/index.mdx#dbinstallxml) schema must match the schema generated by the upgrade at all times.

:::

To create an upgrade step you must:

1. Use the [XMLDB editor](/general/development/tools/xmldb) to create the definition of the new fields
1. Update the `install.xml` from the XMLDB editor
1. Generate the PHP upgrade steps from within the XMLDB Editor
1. Update the version number in your `version.php`

:::tip

In many cases you will be able to combine multiple upgrade steps into a single version change.

:::

When a version number increment is detected during an upgrade, the `xmldb_[pluginname]_upgrade` function is called with the old version number as the first argument.

See the [Upgrade API](../../guides/upgrade/index.md) documentation for more information on the upgrade process.
